!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var e={},n={},o={},r={}.hasOwnProperty,i="components/",a=function(t,e){var n=0;e&&(0===e.indexOf(i)&&(n=i.length),e.indexOf("/",n)>0&&(e=e.substring(n,e.indexOf("/",n))));var r=o[t+"/index.js"]||o[e+"/deps/"+t+"/index.js"];return r?i+r.substring(0,r.length-".js".length):t},s=/^\.\.?(\/|$)/,l=function(t,e){for(var n,o=[],r=(s.test(e)?t+"/"+e:e).split("/"),i=0,a=r.length;a>i;i++)n=r[i],".."===n?o.pop():"."!==n&&""!==n&&o.push(n);return o.join("/")},c=function(t){return t.split("/").slice(0,-1).join("/")},u=function(e){return function(n){var o=l(c(e),n);return t.require(o,e)}},p=function(t,e){var o={id:t,exports:{}};return n[t]=o,e(o.exports,u(t),o),o.exports},d=function(t,o){var i=l(t,".");if(null==o&&(o="/"),i=a(t,o),r.call(n,i))return n[i].exports;if(r.call(e,i))return p(i,e[i]);var s=l(i,"./index");if(r.call(n,s))return n[s].exports;if(r.call(e,s))return p(s,e[s]);throw new Error('Cannot find module "'+t+'" from "'+o+'"')};d.alias=function(t,e){o[e]=t},d.register=d.define=function(t,n){if("object"==typeof t)for(var o in t)r.call(t,o)&&(e[o]=t[o]);else e[t]=n},d.list=function(){var t=[];for(var n in e)r.call(e,n)&&t.push(n);return t},d.brunch=!0,d._cache=n,t.require=d}}(),require.register("application",function(t,e,n){var o,r,i,a,s,l,c,u,p,d=function(t,e){function n(){this.constructor=t}for(var o in e)f.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=e("routes"),a=e("models/config"),s=e("collections/contacts"),l=e("collections/filtered"),p=e("collections/tags"),o=e("views/app_layout"),r=e("views/models/app"),c=e("lib/intent_manager"),i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return d(n,t),n.prototype.initialize=function(){return this.on("before:start",function(){var t;return t=new a(e("imports").config),this.model=new r(null,{model:t}),this.contacts=new s,this.filtered=new l,this.tags=new p,this.layout=new o({model:this.model}),this.router=new u,this.intentManager=new c,"function"==typeof Object.freeze?Object.freeze(this):void 0}),this.on("start",function(){return this.layout.render(),this.contacts.fetch({reset:!0}),this.tags.fetch({reset:!0}),Backbone.history?Backbone.history.start({pushState:!1}):void 0})},n.prototype.search=function(t,n){var o,r,i,a,s;return r=this.model.get("filter"),i="`"+t+":"+n+"`",o=e("config").search.pattern(t),s=null!=r?r.match(o):void 0,n?s?(a=s[1],r=r.replace(o,i)):(null!=r?r.length:void 0)?r+=i:r=i:s&&(r=r.replace(o,"")),this.model.set("filter",r),this.channel.trigger("filter:"+t,n,a)},n}(Mn.Application),n.exports=new i}),require.register("collections/contacts",function(t,e,n){var o,r,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=e("lib/contacts_listener"),o=e("models/contact"),n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.model=o,n.prototype.url="contacts",n.prototype.sortDisabled=!1,n.prototype.initialize=function(){var t;return t=e("application").model,this.comparator="sortedName",this.listenTo(t,{"change:sort":_.ary(this.sort,0)}),this.contactListener=new i,this.listenToOnce(this,"sync",function(){return this.contactListener.watch(this)}),this.tagMap={},this.on("reset",this.resetTagMap),this.on("add",this.addTags),this.on("update",this.addTags)},n.prototype.resetTagMap=function(){var t,e,n,o,r,i,a;for(this.tagMap={},o=this.models,r=[],e=0,n=o.length;n>e;e++)t=o[e],a=t.get("tags")||[],r.push(function(){var t,e,n;for(n=[],t=0,e=a.length;e>t;t++)i=a[t],n.push(this.tagMap[i]=!0);return n}.call(this));return r},n.prototype.addTags=function(t){var e,n,o,r,i;for(i=t.get("tags")||[],o=[],e=0,n=i.length;n>e;e++)r=i[e],o.push(this.tagMap[r]=!0);return o},n.prototype.importFromVCF=function(t){var e,n,r,i;return n=0,e=t.trimRight().split(/END:VCARD/gi).filter(function(t){return!_.isEmpty(t)}).map(function(t){return t+"END:VCARD"}),this.trigger("before:import:progress",e.length),r=e.length,r>10&&this.contactListener.disable(),i=function(t){return function(){var a,s,l,c;return a=e.pop(),a?(c=new VCardParser,c.read(a),l=c.contacts[0],s=new o(l,{parse:!0}),s.save(null,{success:function(){return t.trigger("import:progress",++n),i()},error:function(){return i()}})):(t.trigger("import",n),r>10?(t.fetch({reset:!0}),setTimeout(t.contactListener.enable,1e3)):void 0)}}(this),setTimeout(i,35)},n}(Backbone.Collection)}),require.register("collections/duplicates",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=e("lib/compare_contacts"),n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.model=e("views/models/merge"),n.prototype.url=null,n.prototype.initialize=function(t,e){var n,r;return(n=e.collection)?(r=o.findSimilars(n.toJSON()),r.forEach(function(t){return function(e){return e=e.map(function(t){return n.get(t.id)}),t.add({candidates:e})}}(this))):void 0},n}(Backbone.Collection)}),require.register("collections/filtered",function(t,e,n){var o,r,i,a,s,l,c,u,p,d=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=e("views/models/contact"),l=e("config"),s=l.indexes,u=l.search,p=u.pattern("tag"),i=null,c=new WeakMap,a=_.curry(function(t,e){var n;if(t){if(n=e.match(t).score,!n)return c["delete"](e),!1;c.set(e,n)}return!0}),n.exports=r=function(){function t(){i=e("application"),this.models=[],this.indexes=new Map(Array.prototype.map.call(s,function(t){var e;return e=[],e.channel=Backbone.Radio.channel("idx."+t),[t,e]})),this.listenTo(i.model,{"change:sort":this.reset,"change:scored":function(t,e){return this.comparator=e?function(t,e){return(c.get(null!=e?e.model:void 0)||0)-c.get(t.model)}:"model.attributes.sortedName"}}),this.listenTo(i.channel,{"filter:text":this.setQuery}),this.listenTo(i.contacts,{reset:this.reset,add:this.add,remove:this.remove,update:function(){return this.trigger("update",this)},"change:tags":function(t,e,n){var o,r;return r=_.find(this.models,function(e){return e.model===t}),o=this.indexes.get(r.getIndexKey()),o.channel.trigger("change:tags",r,e,n)},"change:sortedName":function(t){var e;return(e=_.find(this.models,function(e){return e.model===t}))?this.migrateIndex(e):void 0}})}return t.prototype.comparator="model.attributes.sortedName",t.prototype.query=null,t.prototype.setQuery=function(t){var e,n,o,r;return this.query=t,t?(e=i.contacts.filter(a(this.query)),o=this.models.filter(function(t){return _.includes(e,t.model)}),n=_.difference(e,o.map(function(t){return t.model})),r=_.chain(this.models).difference(o).map(function(t){return t.model}).value(),this.remove(r),this.sort(),this.add(n),this.trigger("update",this)):this.reset()},t.prototype.get=function(t){var e,n,o;return null==t&&(t={}),e=t.index?this.indexes.get(t.index):this.models,o=_.last(null!=(n=i.model.get("filter"))?n.match(p):void 0),o&&t.tagged?e.filter(function(t){return _.includes(t.get("tags"),o)}):e},t.prototype.reset=function(){return this.models=i.contacts.filter(a(this.query)).map(function(t){return new o({},{model:t})}),this.resetIndexes(),this.trigger("reset",this)},t.prototype.add=function(t){return t=_.isArray(t)?_.clone(t):[t],t.forEach(function(t){return function(e){var n,r;if(a(t.query,e))return r=new o({},{model:e}),n=_.sortedIndex(t.models,r,t.comparator),t.models.splice(n,0,r),t.addToIndex(r),t.trigger("add",r,t,{add:!0,index:n})}}(this))},t.prototype.remove=function(t){var e;return t=_.isArray(t)?_.clone(t):[t],e=this.models.filter(function(e){var n;return n=e.model,d.call(t,n)>=0}),e.forEach(function(t){return function(e){return _.pull(t.models,e),t.removeFromIndex(e),t.trigger("remove",e,t)}}(this))},t.prototype.sort=function(){return this.models=_.sortBy(this.models,this.comparator),this.trigger("sort",this)},t.prototype.resetIndexes=function(){return this.indexes.forEach(function(t){return t.length=0}),this.models.forEach(function(t){return function(e){return t.addToIndex(e,{silent:!0})}}(this)),this.indexes.forEach(function(t){return t.channel.trigger("reset",t,{})})},t.prototype.addToIndex=function(t,e){var n,o;return null==e&&(e={}),o=this.indexes.get(t.getIndexKey()),_.includes(o,t)?t:(n=_.sortedIndex(o,t,this.comparator),o.splice(n,0,t),e.silent||(o.channel.trigger("add",t,o,{add:!0,index:n}),o.channel.trigger("update",o)),o)},t.prototype.removeFromIndex=function(t,e){var n;return null==e&&(e={}),e.all?this.indexes.forEach(function(n){var o;return o=n.length,n=_.pull(n,t),o===n.length||e.silent?void 0:n.channel.trigger("remove",t,n)}):(n=this.indexes.get(t.getIndexKey()),_.pull(n,t),e.silent?void 0:(n.channel.trigger("remove",t,n),n.channel.trigger("update",n)))},t.prototype.migrateIndex=function(t){var e;return e=this.indexes.get(t.getIndexKey()),_.includes(e,t)?void 0:(this.removeFromIndex(t,{all:!0}),this.addToIndex(t))},t}(),_.extend(r.prototype,Backbone.Events)}),require.register("collections/tags",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("lib/tags_listener"),n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.model=e("models/tag"),n.prototype.url="tags",n.prototype.initialize=function(){return this.listenToOnce(this,"sync",function(){return(new r).watch(this)})},n.prototype.parse=function(t){return _.uniq(t,function(t){return t.name.toLowerCase()})},n}(Backbone.Collection)}),require.register("config",function(t,e,n){n.exports={ERR:{SEARCH_TOO_SHORT:Symbol("ERR_SEARCH_TOO_SHORT")},contact:{xtras:["bday"],datapoints:{main:["tel","email","adr"],types:{"default":["main","work","home"],social:["twitter:social","skype:chat"],url:["website","blog"],share:["cozy"]}}},settings:{sortkeys:["gn","fn"]},indexes:"abcdefghijklmnopqrstuvwxyz#",colorSet:["304FFE","2979FF","00B0FF","00DCE9","00D5B8","00C853","E70505","FF5700","FF7900","FFA300","B3C51D","64DD17","FF2828","F819AA","AA00FF","6200EA","7190AB","51658D"],search:{pattern:function(t,e){return e=t?"i":"ig",new RegExp("`"+(t||"\\w+")+":([^`]+)`",e)}}}}),require.register("initialize",function(t,e,n){var o,r,i=[].slice;r=function(){var t,n,o,r,a,s,l,c;for(n=e("imports").env,t=window.console||{},s=["log","info","warn","error"],l=function(t,e,n,o,r,i){var a;return a={type:t,href:window.location.href,url:n,line:o,col:r,error:{msg:e}},i instanceof Error&&_.extend(a.error,{name:null!=i?i.name:void 0,full:(null!=i?i.toString():void 0)||e,stack:null!=i?i.stack:void 0}),$.post("log",a,"json")},c=function(e){var o;return o=t[e],function(){var r;return r=1<=arguments.length?i.call(arguments,0):[],l(e,JSON.stringify(r)),"production"!==n?o.apply(t,r):void 0}},o=0,r=s.length;r>o;o++)a=s[o],t[a]=c(a);return window.onerror=function(){var t;return t=1<=arguments.length?i.call(arguments,0):[],l.call.apply(l,[null,"error"].concat(i.call(t))),"production"===n}},o=e("./application"),window.t=e("lib/i18n"),ColorHash.addScheme("cozy",e("config").colorSet),Mn.Behaviors.behaviorsLookup=e("lib/behaviors"),document.addEventListener("DOMContentLoaded",function(){return r(),o.start()})}),require.register("lib/behaviors/confirm",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("lib/views/confirm"),n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.ui={confirms:"[data-confirm]"},n.prototype.events={"click @ui.confirms":"confirm"},n.prototype.initialize=function(t){return this.events=_.extend({},this.events,this._buildTriggers())},n.prototype.confirm=function(t){var e;return t.preventDefault(),t.stopPropagation(),e=this.$(t.currentTarget).data("confirm"),this._triggerView(e)},n.prototype._buildTriggers=function(){var t;return t=this.view,_.reduce(this.options.triggers,function(t,e,n){var o,r;return o=function(){return _.defaults({},_.isFunction(e)?e():e,{preventDefault:!0,stopPropagation:!0})},_.isFunction(e)||(r=o()),t[n]=function(t){var n;return _.isFunction(e)&&(r=o()),t&&(t.preventDefault&&r.preventDefault&&t.preventDefault(),t.stopPropagation&&r.stopPropagation&&t.stopPropagation()),n=this._triggerView(r)},t},{})},n.prototype._triggerView=function(t){var n,o,i;return n=e("application"),i=_.pick(t,"title","message","btn_ok","btn_cancel","end_event"),o=new r({model:new Backbone.Model(i)}),this.view.$el.attr("aria-busy",!0),Mn.bindEntityEvents(this,o,{"confirm:close":function(){return this.view.$el.attr("aria-busy",!1),this.view.triggerMethod("confirm:false")},"confirm:true":function(){return t.event&&this.view.triggerMethod(t.event),i.end_event?(o.showLoading(),n.model.on(i.end_event,function(t){return function(){return t.view.$el.attr("aria-busy",!1),t.view.triggerMethod("confirm:true"),n.model.off(i.end_event),o.close()}}(this))):(this.view.$el.attr("aria-busy",!1),this.view.triggerMethod("confirm:true"),o.close())}}),n.layout.showChildView("alerts",o),o},n}(Mn.Behavior)}),require.register("lib/behaviors/dialog",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.behaviors={Keyboard:{keymaps:{27:"key:escape"}}},e.prototype.ui={backdrop:'[role="separator"]',content:'[role="contentinfo"]'},e.prototype.triggers={"click @ui.backdrop":"click:backdrop"},e.prototype.events={"click @ui.content":"detectClickOutside"},e.prototype.initialize=function(){return this.listenTo(this.view,"click:backdrop",this.close),this.listenTo(this.view,"key:escape",this.close)},e.prototype.close=function(){return this.view.triggerMethod("dialog:close")},e.prototype.detectClickOutside=function(t){var e,n,o;if(t.pageX||t.pageY)return e=this.ui.content[0].getBoundingClientRect(),o=t.pageX<e.left||t.pageX>e.right,n=t.pageY<e.top||t.pageY>e.bottom,n&&o?this.close():void 0},e}(Mn.Behavior)}),require.register("lib/behaviors/dropdown",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.ui={trigger:'[aria-haspopup="true"] > :first-child'},e.prototype.events={"click @ui.trigger":"toggleExpand",click:"closeAll"},e.prototype.toggleExpand=function(t){var e;return t.stopPropagation(),e=this.$(t.currentTarget).parent("[aria-haspopup]"),this.closeAll(e),e.attr("aria-expanded","true"!==e.attr("aria-expanded"))},e.prototype.closeAll=function(t){return this.$('[aria-haspopup="true"]').not(t).attr("aria-expanded",!1)},e}(Mn.Behavior)}),require.register("lib/behaviors/form",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.behaviors={Keyboard:{keymaps:{13:{event:"form:key:enter",preventDefault:!1}}}},e.prototype.events=function(){return{"click @ui.formAdd":"addField","keyup @ui.formAutoAdd":"addField","keyup @ui.formInputs":_.debounce(this.updateFields,250),"change @ui.formInputs":"updateFields","click @ui.formClear":"clearField","click @ui.formDelete":"deleteField"}},e.prototype.triggers={"click @ui.formSubmit":"form:submit"},e.prototype.updateFields=function(t,e){var n,o;return null==e&&(e=t.currentTarget),(n={}).setValueOf(e.name,e.value),null!=(o=this.view.model)&&o.set(n,{silent:!0}),e.classList.toggle("empty",""===e.value),this.view.triggerMethod("form:field:update",e,t)},e.prototype.addField=function(t){var e,n,o;return"click"===t.type?this.view.triggerMethod("form:field:add",t.currentTarget.value):(e=this.$(t.currentTarget).parents("[data-type]"),o=e.data("type"),(n=!!e.find(".value").filter(function(){return!this.value}).length)?void 0:this.view.triggerMethod("form:field:add",o))},e.prototype.clearField=function(t){var e;return e=this.$(t.currentTarget).prev(".value"),e.val(null),this.view.triggerMethod("form:field:clear",t),this.updateFields(t,e[0])},e.prototype.deleteField=function(t){var e;return e=this.$(t.currentTarget).parents("[data-cid]").data("cid"),this.view.triggerMethod("form:field:delete",e,t)},e}(Mn.Behavior)}),require.register("lib/behaviors/index",function(t,e,n){var o;o={Confirm:e("./confirm"),Dialog:e("./dialog"),Dropdown:e("./dropdown"),Form:e("./form"),Keyboard:e("./keyboard"),Navigator:e("./navigator"),PickAvatar:e("./pickavatar")},n.exports=o}),require.register("lib/behaviors/keyboard",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.defaults={eventName:"keydown"},e.prototype.events=function(){var t,e;if(this.options.keymaps)return e=_.reduce(this.options.keymaps,this._buildKeyboardTrigger,{}),(t={})[this.options.eventName]=function(t){return function(n){var o;return o=n.which.toString(),a.call(_.keys(e),o)<0?void 0:e[o].call(t,n)}}(this),t},e.prototype._buildKeyboardTrigger=function(t,e,n){var o,r,i;return r=_.isObject(e),i=_.defaults({},r?e:{},{preventDefault:!0,stopPropagation:!0}),o=r?i.event:e,t[n]=function(t){return t&&(t.preventDefault&&i.preventDefault&&t.preventDefault(),t.stopPropagation&&i.stopPropagation&&t.stopPropagation()),this.view.triggerMethod(o,t)},t},e}(Mn.Behavior)}),require.register("lib/behaviors/navigator",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.behaviors={Confirm:{}},n.prototype.events={"click @ui.navigate":"navigate"},n.prototype.navigate=function(t){var n;return t.preventDefault(),n=function(){var n,o;return o=t.currentTarget,n=o.dataset.next||o.getAttribute("href"),e("application").router.navigate(n,{trigger:!0})},t.currentTarget.dataset.confirm?Mn.bindEntityEvents(this,this.view,{"confirm:true":n,"confirm:close":function(){return Mn.unbindEntityEvents(this,this.view)}}):n()},n}(Mn.Behavior)}),require.register("lib/behaviors/pickavatar",function(t,e,n){var o,r=function(t,e){return function(){return t.apply(e,arguments)}},i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;n.exports=o=function(t){function n(){return this.choosePhoto_answer=r(this.choosePhoto_answer,this),this.choosePhoto=r(this.choosePhoto,this),n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.events=function(){return{"click @ui.avatar":"choosePhoto"}},n.prototype.choosePhoto=function(){var t,n,o;return t=e("application"),n={type:"pickObject",params:{objectType:"singlePhoto",isCropped:!0,proportion:1,maxWidth:10,minWidth:10}},o=108e5,t.intentManager.send("nameSpace",n,o).then(this.choosePhoto_answer,function(t){return console.error("contact : response in error : ",t)})},n.prototype.choosePhoto_answer=function(t){var e,n;return e=t.data,e.newPhotoChosen&&null!=(n=this.view.model)?n.set("avatar",e.dataUrl):void 0},n}(Mn.Behavior)}),require.register("lib/compare_contacts",function(t,e,n){var o,r,i,a,s;r=e("lib/contact_helper"),n.exports=o={},o.isSamePerson=function(t,e){return t.fn===e.fn&&t.datapoints.some(function(t){var n;return"tel"===(n=t.name)||"adr"===n||"email"===n||"chat"===n?s(t,e):!1})},o.mayBeSamePerson=function(t,e){return compareN(t.n,e.n)>0},o.findSimilars=function(t){var e,n,o,r,i,a,s,l,c;for(c=[],s={},r=0,a=t.length;a>r;r++)e=t[r],l=e.n.split(";"),i=l[0],o=l[1],n=l[2],n=l[3],n=l[4],i=i.toAscii().toLowerCase(),o=o.toAscii().toLowerCase(),null!=s[o+" "+i]?s[o+" "+i].push(e):null!=s[i+" "+o]?s[i+" "+o].push(e):(o+" "+i).length>1&&(s[o+" "+i]=[],s[o+" "+i].push(e));return c=Object.keys(s).filter(function(t){return s[t].length>1}).map(function(t){return s[t]})},o.mergeContacts=function(t,e){return e.datapoints.forEach(function(e){return s(e,t,!0)?void 0:t.datapoints.push(e)}),delete e.datapoints,null!=e.accounts&&(e.accounts.forEach(function(e){return r.hasAccount(t,e.type,e.name)?void 0:r.setAccount(t,e)}),delete e.accounts),t.tags=a(t.tags,e.tags),delete e.tags,null!=e.note&&""!==e.note&&null!=t.note&&""!==t.note&&(t.note+="\n"+e.note),delete e.note,t=i(t,e)},s=function(t,e,n){return null==n&&(n=!1),null==t.value?!1:e.datapoints.some(function(e){var o,r,i;if(t.name===e.name&&(!n||n&&t.type===e.type)&&null!=e.value){if("tel"===t.name)return t.value.replace(/[-\s]/g,"")===e.value.replace(/[-\s]/g,"");if("adr"===t.name){for(i=!0,o=0;i&&7>o;)i=i&&t.value[o]===e.value[o]||""===t.value[o]&&null==e.value[o]||!(null!=(r=t.value)?r[o]:void 0)&&""===e.value[o],o++;return i}return t.value===e.value}return!1})},a=function(t,e){return t=t||[],e=e||[],t.concat(e.filter(function(e){return t.indexOf(e)<0}))},i=function(t,e){var n,o;for(n in e)o=e[n],null!=o&&(t[n]=o);return t}}),require.register("lib/contact_helper",function(t,e,n){var o,r,i=[].slice;n.exports=o={},o.nToFN=function(t){var e,n,o,r,i,a;return t=t||[],e=t[0],n=t[1],o=t[2],i=t[3],a=t[4],r=[i,n,o,e,a],r=r.filter(function(t){return null!=t&&""!==t}),r.join(" ")},o.fnToN=function(t){return t=t||"",["",t,"","",""]},o.fnToNLastnameNFirstname=function(t){var e,n,o,r,a,s;return t=t||"",s=t.split(" "),n=s[0],r=3<=s.length?i.call(s,1,o=s.length-1):(o=1,[]),e=s[o++],a=[e,n,r.join(" "),"",""]},r=function(t){return t=t.filter(function(t){return null!=t&&""!==t}),t.join(", ")},o.adrArrayToString=function(t){var e,n,o;return t=t||[],o=r(t.slice(0,3)),e=r(t.slice(3,7)),n=o,""!==e&&(n+="\n"+e),n},o.adrCompleteStreet=function(t){return t=t||[],r(t.slice(0,3))},o.adrStringToArray=function(t){return t=t||"",["","",t,"","","",""]},o.imgUrl2DataUrl=function(t,e){var n;return n=new Image,n.onload=function(){var t,o,r,i,a,s;return t=600,s=n.width>n.height?"height":"width",a=t/n[s],o=document.createElement("canvas"),o.height=o.width=t,r=o.getContext("2d"),r.drawImage(n,0,0,a*n.width,a*n.height),i=o.toDataURL("image/jpeg"),e(null,i)},n.src=t},o.getAccount=function(t,e,n){var o;return null==t.accounts?null:(o=t.accounts.filter(function(t){return t.type===e&&t.name===n}),o.length>0?o[0]:null)},o.setAccount=function(t,e){var n,r,i,a;if(n=o.getAccount(t,e.type,e.name),null!=n){i=[];for(r in e)a=e[r],i.push(n[r]=a);return i}return t.accounts=t.accounts||[],t.accounts.push(e)},o.deleteAccount=function(t,e){var n,o,r,i,a;for(a=t.accounts,o=r=0,i=a.length;i>r;o=++r)if(n=a[o],n.type===e.type&&n.name===e.name)return contacts.accounts.splice(o,1),!0;return!1},o.hasAccount=function(t,e,n){return null!=o.getAccount(t,e,n)},o.intrinsicRev=function(t){var e,n,r,i,a,s;for(r=["fn","n","org","title","bday","nickname","url","note"],e="",i=0,a=r.length;a>i;i++)n=r[i],n in t&&null!=t[n]&&""!==t[n]&&(e+=n,e+=": ",e+=t[n],e+=", ");return s=t.datapoints.map(function(t){var e,n;return n="name:"+t.name+", type:"+t.type+", value: ",n+="adr"===t.name?o.adrArrayToString(t.value):"tel"===t.name?null!=(e=t.value)?e.replace(/[^\d+]/g,""):void 0:t.value}),s.sort(),e+="datapoints: "+s.join(", ")},o.getNonEmptyDatapoints=function(t){return t.filter(function(t){return!_.isEmpty(t.get("value"))})}}),require.register("lib/contacts_listener",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=e("models/contact"),n.exports=r=function(t){function e(){e.__super__.constructor.apply(this,arguments),this._bulk=_.debounce(this._bulk,1e3),this.enabled=!0}return i(e,t),e.prototype.models={contact:o},e.prototype.queues={create:[],update:[],"delete":[]},e.prototype.events=["contact.create","contact.update","contact.delete"],e.prototype._bulk=function(t){var e,n,o;switch(t){case"delete":e="remove",o={};break;default:e="add",o={merge:!0,trigger:!1}}return o.sort=!1,this.enabled?(console.log("Remote action occured ("+t+", "+e+"), processing start!"),n=this.queues[t].length,async.whilst(function(e){return function(){return e.queues[t].length>0}}(this),function(n){return function(r){var i;return i=n.queues[t].splice(0,50),n.collection[e](i,o),setTimeout(r,100)}}(this),function(){return console.log("Remote action processing done for "+n+" for operation\n("+t+", "+e+").")})):this.queues[t]=[]},e.prototype.enable=function(){return this.enabled=!0},e.prototype.disable=function(){return this.enabled=!1},e.prototype.onRemoteCreate=function(t){return this.queues.create.push(t),this._bulk("create")},e.prototype.onRemoteUpdate=function(t){return this.queues.update.push(t),this._bulk("update")},e.prototype.onRemoteDelete=function(t){return this.queues["delete"].push(t),this._bulk("delete")},e}(CozySocketListener)}),require.register("lib/i18n",function(t,e,n){var o;o=function(){var t,n,o,r,i;o=document.documentElement.getAttribute("lang");try{r=e("locales/"+o)}catch(n){t=n,r=e("locales/en")}return i=new Polyglot({phrases:r,locale:o}),i.t.bind(i)},n.exports=o()}),require.register("lib/intent_manager",function(t,e,n){var o,r;r=3e3,n.exports=o=function(){function t(){this.talker=new Talker(window.parent,"*")}return t.prototype.send=function(t,e,n){return this.talker.timeout=n?n:r,this.talker.send("nameSpace",e)},t}()}),require.register("lib/regions/dialogs",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.toggleDialogs=function(t){return null==t&&(t="true"!==this.$el.attr("aria-hidden")),this.$el.attr("aria-hidden",!t)},e.prototype.onShow=function(){return this.toggleDialogs(!0)},e.prototype.onBeforeEmpty=function(){return this.toggleDialogs(!1)},e}(Mn.Region)}),require.register("lib/request",function(t,e,n){var o;n.exports=o={send:function(t,e,n,o){return $.ajax({type:t,url:e,data:null!=n?JSON.stringify(n):null,contentType:"application/json",dataType:"json",success:function(t){return null!=o?o(null,t):void 0},error:function(t){return null!=t&&null!=t.msg&&null!=o?o(new Error(t.msg)):null!=o?o(new Error("Server error occured")):void 0}})},get:function(t,e){return o.send("GET",t,null,e)},post:function(t,e,n){return o.send("POST",t,e,n)},put:function(t,e,n){return o.send("PUT",t,e,n)},del:function(e,n){return t.request("DELETE",e,null,n)}}}),require.register("lib/tags_listener",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=e("models/tag"),n.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.models={tag:o},e.prototype.events=["tag.create","tag.update","tag.delete"],e.prototype.onRemoteCreate=function(t){return this.collection.add(t,{merge:!0})},e.prototype.onRemoteUpdate=function(t){return this.collection.add(t,{merge:!0})},e.prototype.onRemoteDelete=function(t){return this.collection.remove(t)},e}(CozySocketListener)}),require.register("lib/views/confirm",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.template=e("./templates/confirm"),n.prototype.tagName="section",n.prototype.attributes={role:"alertdialog","aria-busy":!1},n.prototype.ui={btn_ok:"button.ok",btn_cancel:"button.cancel"},n.prototype.triggers={"click @ui.btn_ok":"confirm:true","click @ui.btn_cancel":"confirm:false"},n.prototype.onDomRefresh=function(){return setTimeout(function(t){return function(){return t.$el.attr("aria-busy",!0)}}(this),50)},n.prototype.close=function(){var t;return t=e("application").layout,t.alerts.empty()},n.prototype.onConfirmFalse=n.prototype.close,n.prototype.showLoading=function(){return this.ui.btn_ok.attr("aria-busy",!0)},n.prototype.hideLoading=function(){return this.ui.btn_ok.attr("aria-busy",!1)},n}(Mn.ItemView)}),require.register("lib/views/templates/base/alert",function(t,e,n){var o=function(t){var e=[];return e.push('<div class="wrapper"><div role="contentinfo"></div></div>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("lib/views/templates/base/dialog",function(t,e,n){var o=function(t){var e=[];return e.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo"></div></div>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("lib/views/templates/confirm",function(t,e,n){var o=function(t){var e,n=[],o=t||{};return function(t,o,r,i){n.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo"><h2>'+jade.escape(null==(e=i)?"":e)+"</h2><p>"+jade.escape(null==(e=r)?"":e)+'</p><nav><ul class="actions"><li><button class="ok">'+jade.escape(null==(e=o)?"":e)+'</button></li><li><button class="secondary cancel">'+jade.escape(null==(e=t)?"":e)+"</button></li></ul></nav></div></div>")}.call(this,"btn_cancel"in o?o.btn_cancel:"undefined"!=typeof btn_cancel?btn_cancel:void 0,"btn_ok"in o?o.btn_ok:"undefined"!=typeof btn_ok?btn_ok:void 0,"message"in o?o.message:"undefined"!=typeof message?message:void 0,"title"in o?o.title:"undefined"!=typeof title?title:void 0),n.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("locales/en",function(t,e,n){n.exports={"list counter":"%{smart_count} contact |||| %{smart_count} contacts","list counter no-search":"no contact matches your criteria","list counter empty":"no contact at this time","tools subactions settings":"settings","tools actions add contact":"add contact","tools actions find duplicates":"find duplicates","tools search placeholder":"search for contacts","tools labels filters":"labels","tools labels filters all":"all contacts","tools contextual selected":"%{smart_count} contact selected |||| %{smart_count} contacts selected","tools contextual select all":"select all","tools contextual select none":"select none","tools contextual merge":"merge","tools contextual export":"export","tools contextual delete":"delete","bulk confirm delete title":"Delete contact |||| Delete contacts","bulk confirm delete message":"You'll delete a contact. Are you sure? |||| You'll delete %{smart_count} contacts. Are you sure?",
"bulk confirm delete ok":"delete","bulk confirm delete cancel":"keep 'em safe","settings title":"settings","settings in-out title":"import/export contacts","settings in-out import action":"import vcard","settings in-out export action":"export vcard","settings in-out import result":"You've just successfully imported %{smart_count} contact. |||| You've just successfully imported %{smart_count} contacts.","settings display title":"display settings","settings display sort gn":"sort by last name","settings display sort fn":"sort by first name","settings sync title":"mobile synchronization","settings sync gplay":"Access all your Cozy directly on your mobile device. Download our app now on the Google Play Store:","settings sync gplay get it":"Get it on Google play","settings sync carddav":"Looking for more information about the synchronization using CardDav? Take a look at [our documentation](%{link}).","card actions create":"create","card actions save":"save","card actions labels":"labels","card actions labels add":"add label","card actions labels create":"create label","card actions cancel":"cancel","card actions edit":"edit","card actions delete":"delete","card actions export":"export","card actions add select":"add field","card actions add birthday":"birthday","card actions add social":"social media","card actions add link":"url","card actions add other":"other information","card actions add share":"cozy cloud","card confirm delete title":"Remove %{name}?","card confirm delete message":"You'll remove %{name} from your contacts. Are you sure?","card confirm delete ok":"Delete Contact","card confirm delete cancel":"Keep it","card confirm cancel title":"Are you sure you want to leave?","card confirm cancel message":"Your contact hasn't been saved.","card confirm cancel ok":"Leave","card confirm cancel cancel":"Stay on Edit Mode","datapoints section tel":"Phone numbers","datapoints section email":"Email addresses","datapoints section adr":"Postal addresses","datapoints section xtras":"Additional informations","datapoint label name prefix":"prefix","datapoint label name first":"first name","datapoint label name middle":"middle name","datapoint label name given":"last name","datapoint label name suffix":"suffix","datapoint label org":"company","datapoint placeholder org":"add company name","datapoint label department":"department","datapoint placeholder department":"add department","datapoint label title":"title","datapoint placeholder title":"add title","datapoint placeholder tel":"add phone number","datapoint placeholder email":"add email address","datapoint placeholder adr":"add address","datapoint placeholder social":"add social media nickname","datapoint placeholder im":"add social media nickname","datapoint placeholder chat":"add social media nickname","datapoint placeholder url":"add an url","datapoint placeholder other":"add any information","datapoint placeholder share":"add cozy cloud url","datapoint label bday":"birthday","datapoint placeholder bday":"YYYY-MM-DD","datapoint label note":"notes","duplicates title":"Find Duplicates","duplicates actions mergeall":"merge all","duplicates empty":"No duplicates found","mergerow actions merge":"merge","mergerow actions dismiss":"dismiss","merge title":"Merge contacts","merge choose avatar":"Choose a profile picture:","merge choose name":"Choose a name:","merge choose nickname":"Choose a nickname:","merge choose organisation":"Choose an organisation:","merge choose org":"company","merge choose department":"department","merge choose title":"title","merge choose birthday":"Choose a birthday:","merge actions merge":"merge contacts","merge actions cancel":"cancel","error upload wrong filetype":"The uploaded file isn't a valid VCF/VCard format. Please try with another file.","error search too short":"you need to input at least 3 characters to perform a search"}}),require.register("locales/fr",function(t,e,n){n.exports={"list counter":"%{smart_count} contact |||| %{smart_count} contacts","list counter no-search":"aucun contact ne correspond à votre recherche","list counter empty":"aucun contact disponible","tools subactions settings":"configuration","tools actions add contact":"ajouter un contact","tools actions find duplicates":"doublons","tools search placeholder":"rechercher des contacts","tools labels filters":"libellés","tools labels filters all":"tous les contacts","tools contextual selected":"%{smart_count} contact sélectionné |||| %{smart_count} contacts sélectionnés","tools contextual select all":"tout sélectionner","tools contextual select none":"tout désélectionner","tools contextual merge":"fusionner","tools contextual export":"exporter","tools contextual delete":"supprimer","bulk confirm delete title":"Supprimer le contact |||| Supprimer les contacts","bulk confirm delete message":"Vous allez supprimer un contact. Le voulez-vous vraiment ? |||| Vous aller supprimer %{smart_count} contacts. Le voulez-vous vraiment ? ","bulk confirm delete ok":"Supprimer","bulk confirm delete cancel":"Conserver","settings title":"configuration","settings in-out title":"importer / exporter les contacts","settings in-out import action":"importer un fichier vcard","settings in-out export action":"exporter vos contacts","settings in-out import result":"Vous avez importé %{smart_count} contact. |||| Vous avez importé %{smart_count} contacts.","settings display title":"affichage","settings display sort gn":"trier par nom","settings display sort fn":"trier par prénom","settings sync title":"synchronisation mobile","settings sync gplay":"Accédez à votre Cozy depuis votre mobile. Télécharger notre application sur le Google Play Store :","settings sync gplay get it":"Disponible sur Google Play","settings sync carddav":"Besoin de synchronisation CardDav ? Jetez un œil à [notre documentation](%{link}).","card actions create":"créer","card actions save":"enregistrer","card actions labels":"libellés","card actions labels add":"ajouter un libellé","card actions labels create":"créer un libellé","card actions cancel":"annuler","card actions edit":"modifier","card actions delete":"supprimer","card actions export":"exporter","card actions add select":"ajouter un champ","card actions add birthday":"date de naissance","card actions add social":"réseau social","card actions add link":"lien","card actions add other":"autre","card confirm delete title":"Supprimer %{name} ?","card confirm delete message":"Vous allez supprimer %{name} de vos contacts. Le voulez-vous vraiment ?","card confirm delete ok":"Le supprimer","card confirm delete cancel":"Le garder","card confirm cancel title":"Voulez-vous vraiment quitter l'édition ?","card confirm cancel message":"Vos modifications n'ont pas été sauvées.","card confirm cancel ok":"Quitter","card confirm cancel cancel":"Rester","datapoints section tel":"Numéros de téléphone","datapoints section email":"Adresses email","datapoints section adr":"Adresses postales","datapoints section xtras":"Informations complémentaires","datapoint label name prefix":"civilité","datapoint label name first":"prénom","datapoint label name middle":"surnom","datapoint label name given":"nom","datapoint label name suffix":"particule","datapoint label org":"société","datapoint placeholder org":"ajouter une société","datapoint label department":"département","datapoint placeholder department":"ajouter un département","datapoint label title":"poste","datapoint placeholder title":"ajouter un poste","datapoint placeholder tel":"ajouter un numéro de téléphone","datapoint placeholder email":"ajouter une adresse email","datapoint placeholder adr":"ajouter une adresse","datapoint placeholder social":"ajouter un nom d'utilisateur","datapoint placeholder im":"ajouter un nom d'utilisateur","datapoint placeholder chat":"ajouter un nom d'utilisateur","datapoint placeholder url":"ajouter une url","datapoint placeholder other":"ajouter une information","datapoint label bday":"anniversaire","datapoint placeholder bday":"YYYY-MM-DD","datapoint label note":"notes","duplicates title":"Doublons","duplicates actions mergeall":"tout fusionner","duplicates empty":"Aucun doublon détecté","mergerow actions merge":"fusionner","mergerow actions dismiss":"abandonner","merge title":"Fusionner les contacts","merge choose avatar":"Choisissez une photo de profil :","merge choose name":"Choisissez un nom :","merge choose nickname":"Choisissez un surnom :","merge choose organisation":"Choisissez une organisation:","merge choose org":"société","merge choose department":"département","merge choose title":"poste","merge choose birthday":"Choisissez un anniversaire :","merge actions merge":"fusionner","merge actions cancel":"annuler","error upload wrong filetype":"Le fichier sélectionné n'est pas un format VCard/VCF valide. Essayez avec un autre fichier."}}),require.register("models/config",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.url="config",e}(Backbone.Model)}),require.register("models/contact",function(t,e,n){var o,r,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=void 0,r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.defaults={name:"other",type:"other",value:"",mediatype:""},e.prototype.parse=function(t){return"adr"===t.name&&_.isArray(t.value)&&(t.value=VCardParser.adrArrayToString(t.value)),t},e}(Backbone.Model),n.exports=o=function(t){function n(){i=e("application"),n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.urlRoot="contacts",n.prototype.defaults={n:";;;;"},n.prototype.parse=function(t){var e,n,o,i,a,s,l;for(i in t)l=t[i],""===l&&delete t[i];return t.n&&(a=t.n.split(";"),o=a[0],n=a[1],t.initials=_.chain([n,o]).compact().map(function(t){return t[0].toAscii()[0]}).join("").value(),t.sortedName=this._buildSortedName(t.n)),(s=t.url)&&(delete t.url,t.datapoints.unshift({name:"url",type:"main",value:s})),e=this.attributes.datapoints||new Backbone.Collection(t.datapoints||[],{model:r,parse:!0}),e.comparator="name",t.datapoints=e,t.tags=_.invoke(t.tags,"toLowerCase"),t},n.prototype.sync=function(t,e,o){var r,i;return r=e.get("avatar")||e.get("photo"),r&&(e.unset("avatar",{silent:!0}),e.unset("photo",{silent:!0}),i=o.success,o.success=function(t){return function(e,n,a){return t.savePicture(r,e,{success:function(){return i.apply(t,arguments),t.fetch()},error:o.error})}}(this)),n.__super__.sync.apply(this,arguments)},n.prototype.validate=function(t,e){var n,o,r,i,a,s,l;if(t.fn=VCardParser.nToFN(t.n.split(";")),r=(null!=(l=t.datapoints)?l.toJSON():void 0)||[],t.datapoints=r.map(function(t){return"adr"===t.name&&(t.value=VCardParser.adrStringToArray(t.value)),t}),s=_.findWhere(t.datapoints,{name:"url",mediatype:""}),s&&(t.datapoints=_.without(t.datapoints,s),t.url=s.value),o=_.where(t.datapoints,{name:"share"}),!_.isEmpty(o))for(i=0,a=o.length;a>i;i++)n=o[i],n.name="url",n.mediatype="cloud:cozy";return e.attrs=t,!1},n.prototype._buildSortedName=function(t){var e,n,o,r,a;return null==t&&(t=this.get("n")),a=i.model.get("sort"),r=t.split(";"),n=r[0],e=r[1],o=r[2],_.chain("fn"===a?[e,o,n]:[n,e,o]).compact().join(" ").value()},n.prototype.initialize=function(){return this.listenTo(i.model,{"change:sort":function(){return this.set({sortedName:this._buildSortedName()})}})},n.prototype.toString=function(t){var e,n,o,r,i,a;return null==t&&(t={}),i=this.attributes.n.split(";"),n=i[0],e=i[1],o=i[2],r=i[3],a=i[4],n=_.compact([t.pre,n,t.post]).join(""),_.compact([r,e,o,n,a]).join(" ")},n.prototype.toHighlightedString=function(t,e){var n,o,r,i;return null==e&&(e={}),n=e.format?{pre:"»",post:"«"}:void 0,r=this.toString(n),t&&(o=fuzzy.match(t,r,e)),i=o?o.rendered:r,n&&(i=i.replace("»",e.format.pre).replace("«",e.format.post)),i},n.prototype.match=function(t,e){var n,o,r,i,a,s,l,c,u;for(null==e&&(e={}),l=!1,n=e.format?{pre:"»",post:"«"}:void 0,c=[this.toString(n)],e.fullsearch&&(a=_.compact(this.attributes.datapoints.map(function(t){return"adr"!==t.get("name")?t.get("value"):void 0})),c=c.concat(a).concat(this.attributes.tags)),o=r=0,i=c.length;i>r;o=++r)if(u=c[o],s=fuzzy.match(t,u,e)){l=s,0===o&&n&&(l.rendered=s.rendered.replace("»",e.format.pre).replace("«",e.format.post));break}return l},n.prototype.savePicture=function(t,e,n){var o,r,i,a,s,l,c;if(!e.id)return n.error(new Error("Model should have been saved once."));for(r=atob(t),o=[],s=l=0,c=r.length;c>=0?c>=l:l>=c;s=c>=0?++l:--l)o.push(r.charCodeAt(s));return i=new Blob([new Uint8Array(o)],{type:"image/jpeg"}),a=new FormData,a.append("picture",i),a.append("contact",e),$.ajax({type:"PUT",url:"contacts/"+e.id+"/picture",data:a,contentType:!1,processData:!1,success:n.success,error:n.error})},n.prototype.picturetoa=function(t){var e,n;return(null!=(n=this.attributes._attachments)?n.picture:void 0)?(e=new Image,e.onload=function(){var e,n,o,r;return n=document.createElement("canvas"),n.width=this.naturalWidth,n.height=this.naturalHeight,o=n.getContext("2d"),o.drawImage(this,0,0),r=n.toDataURL("image/jpeg").split(","),e=r[r.length-1],t(e)},e.src="contacts/"+this.id+"/picture.png"):t()},n.prototype.toVCF=function(t){var e;return e=this.toJSON(),e.datapoints=e.datapoints.toJSON(),this.picturetoa(function(n){return t(VCardParser.toVCF(e,n))})},n.prototype.getLastAndFirstNames=function(){var t;return t=this.get("n").split(";"),""+t[1]+t[0]},n}(Backbone.Model)}),require.register("models/tag",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.urlRoot="tags",e.prototype.parse=function(t){return t.name=t.name.toLowerCase(),t},e}(Backbone.Model)}),require.register("routes/contacts",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};r=void 0,n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.routes={"new":"create",duplicates:"duplicates",":slug":"show",":slug/edit":"edit","":"index"},n.prototype.initialize=function(){return r=e("application")},n.prototype._ensureContacts=function(t){return _.isFunction(t)?r.contacts.isEmpty()?this.listenToOnce(r.contacts,"sync",t):t():void 0},n.prototype._setCardState=function(t,e){var n;return n=s.call(r.contacts.pluck("id"),t)>=0||"new"===t,r.model.set("dialog",n?t:!1),r.channel.trigger("mode:edit",e)},n.prototype.index=function(){return r.search("tag",null)},n.prototype.show=function(t){return this._ensureContacts(_.wrap(this._setCardState,function(e){return e(t)}))},n.prototype.edit=function(t){return this._ensureContacts(_.wrap(this._setCardState,function(e){return e(t,!0)}))},n.prototype.create=function(){return this._setCardState("new",!0)},n.prototype.duplicates=function(){return this._ensureContacts(function(){return r.model.set("dialog","duplicates")})},n}(Backbone.SubRoute)}),require.register("routes/index",function(t,e,n){var o,r,i,a,s=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=e("routes/contacts"),i=e("routes/tags"),a=void 0,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.routes={settings:"settings","contact/:slug":"legacyContactRedirect","":"index"},n.prototype.initialize=function(){return a=e("application"),a.on("start",function(){var t,e;return t=new o("contacts"),e=new i("tags")}),this.listenTo(a.model,"change:dialog",function(t,e){var n,o,r;if(!e)return n=null!=(r=a.model.get("filter"))?r.match(/tag:(\w+)/i):void 0,o=n?"tags/"+n[1]:"contacts",this.navigate(o)})},n.prototype.index=function(){return this.navigate("contacts",{trigger:!0})},n.prototype.settings=function(){return a.model.set("dialog","settings")},n.prototype.legacyContactRedirect=function(t){return this.navigate("contacts/"+t,{trigger:!0})},n}(Backbone.Router)}),require.register("routes/tags",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=void 0,n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.routes={":slug":"filter"},n.prototype.initialize=function(){var t;return r=e("application"),t=document.createElement("style"),t.appendChild(document.createTextNode("")),document.head.appendChild(t),this.sheet=t.sheet,this.listenTo(r.channel,"filter:tag",function(t){return function(e){var n,o,r,i,a,s;for(i=t.sheet.cssRules,a=[],o=n=0,r=i.length;r>n;o=++n)s=i[o],a.push(t.sheet.deleteRule(o));return a}}(this))},n.prototype.filter=function(t){var e;return r.search("tag",t),e=this.sheet.cssRules.length,this.sheet.insertRule("[role=row]:not(.tag_"+t+"),\n[role=rowgroup]:not(.tag_"+t+") { display: none }",e)},n}(Backbone.SubRoute)}),require.register("views/app_layout",function(t,e,n){var o,r,i,a,s,l,c,u,p,d,f,h,m,g=function(t,e){function n(){this.constructor=t}for(var o in e)v.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},v={}.hasOwnProperty;i=e("models/contact"),a=e("views/models/contact"),c=e("views/tools/default_actions"),l=e("views/tools/context_actions"),p=e("views/labels"),f=e("views/tools/toolbar"),s=e("views/contacts"),r=e("views/contacts/card"),u=e("views/duplicates"),d=e("views/settings"),m=e("lib/i18n"),h=void 0,n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return g(n,t),n.prototype.template=e("views/templates/layouts/app"),n.prototype.el='[role="application"]',n.prototype.behaviors={Navigator:{},Dropdown:{},Keyboard:{keymaps:{33:"key:pageup",34:"key:pagedown"}}},n.prototype.ui={navigate:'aside [role="button"], .name',content:'main [role="contentinfo"] ',counter:"main .counter"},n.prototype.regions={actions:"aside .tool-actions",labels:"aside .tool-labels",indexes:"@ui.content .indexes",results:"@ui.content .results",toolbar:'main [role="toolbar"]',dialogs:{selector:".dialogs",regionClass:e("lib/regions/dialogs")},alerts:{selector:".alerts",regionClass:e("lib/regions/dialogs")}},n.prototype.modelEvents={"change:dialog":"showDialog","change:selected":"swapContextualMenu","change:scored":"onSearchResults"},n.prototype.childEvents={"drawer:toggle":"toggleDrawer","contacts:select":function(t,e){return this.model.select(e)},"contacts:unselect":function(t,e){return this.model.unselect(e)},"dialog:close":function(){return this.model.set("dialog",!1)}},n.prototype.initialize=function(){return h=e("application"),this.listenToOnce(h.tags,{sync:this.showFilters}),this.listenToOnce(h.contacts,{sync:this.showContactsList}),this.listenTo(h.filtered,{update:this.updateCounter}),this.listenTo(h.model,{"change:filter":this.updateCounter}),this.listenTo(h.channel,{"busy:enable":function(){return this.$el.attr("aria-busy",!0)},"busy:disable":function(){return this.$el.attr("aria-busy",!1)},"filter:text":this.toggleResults,"search:error":this.error})},n.prototype.onRender=function(){return this.showChildView("toolbar",new f),this.showChildView("actions",new c)},n.prototype.showFilters=function(){return this.showChildView("labels",new p({model:this.model}))},n.prototype.showContactsList=function(){var t;return t=new s({collection:h.filtered}),this.listenToOnce(t,{show:function(){return this.ui.content.trigger("focus"),this.updateCounter()}}),this.showChildView("indexes",t)},n.prototype.onKeyPageup=function(){var t;return t=this.ui.content[0],t.scrollTop-=t.offsetHeight},n.prototype.onKeyPagedown=function(){var t;return t=this.ui.content[0],t.scrollTop+=t.offsetHeight},n.prototype.swapContextualMenu=function(t,e){var n;return n=t._previousAttributes.selected,n.length&&e.length?void 0:_.isEmpty(e)?this.showChildView("actions",new c):this.showChildView("actions",new l({model:this.model}))},n.prototype.toggleDrawer=function(){var t,e;return t=this.$("aside.drawer"),e="true"===t.attr("aria-expanded"),t.attr("aria-expanded",!e)},n.prototype.onSearchResults=function(t,e){return this.indexes.$el.attr("aria-hidden",e),e?setTimeout(function(t){return function(){var e;return e=new s({collection:h.filtered}),t.showChildView("results",e)}}(this)):this.results.reset()},n.prototype.toggleResults=function(t){var e;return null!=(e=this.results.$el)?e.attr("aria-hidden",!t.length):void 0},n.prototype.showDialog=function(t,e){var n;return e?(n=function(){switch(e){case"settings":return new d({model:this.model});case"duplicates":return new u;default:return this._buildContactView(e)}}.call(this),this.showChildView("dialogs",n)):this.dialogs.empty()},n.prototype._buildContactView=function(t){var e,n;return e="new"===t?new i(null,{parse:!0}):h.contacts.get(t),n=new a({"new":"new"===t},{model:e}),n.listenTo(h.channel,"mode:edit",function(t){return this.set("edit",t)}),new r({model:n})},n.prototype.updateCounter=function(){return window.requestAnimationFrame(function(t){return function(){var e,n;return h.contacts.length?(n=h.filtered.get({tagged:!0}).length,e=n?m("list counter",{smart_count:n}):m("list counter no-search")):e=m("list counter empty"),t.ui.counter.text(e).toggleClass("important",!n)}}(this))},n.prototype.error=function(t){var n;return n=e("config").ERR,t===n.SEARCH_TOO_SHORT?(this.results.$el.attr("aria-hidden",!0),this.ui.counter.text(m("error search too short")).addClass("important")):void 0},n}(Mn.LayoutView)}),require.register("views/contacts/card",function(t,e,n){var o,r,i,a,s,l,c=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function n(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=e("views/contacts/components/avatar"),a=e("views/contacts/components/data"),s=e("views/contacts/components/edit_tags"),l=e("lib/i18n"),r=e("config").contact,n.exports=i=function(t){function n(){return this._deleteModalCfg=c(this._deleteModalCfg,this),n.__super__.constructor.apply(this,arguments)}return u(n,t),n.prototype.template=e("views/templates/contacts/card"),n.prototype.tagName="section",n.prototype.className="card",n.prototype.attributes={role:"dialog"},n.prototype.behaviors=function(){return{Navigator:{},Dialog:{},Form:{},Dropdown:{},Confirm:{triggers:{"click @ui.btnDelete":this._deleteModalCfg}}}},n.prototype.ui={btnEdit:'.edit[role="button"]',btnDelete:"button.delete",btnExport:'[formaction="contact/export"]',navigate:"[href^=contacts], [data-next]",formSubmit:'[type="submit"]',formClear:"button.clear",formInputs:".group:not([data-cid]) input, .group:not([data-cid]) textarea",avatar:".avatar"},n.prototype.regions={avatar:'[role="img"]',infos:".data",tags:"aside .tags"},n.prototype.triggers={"click @ui.btnExport":"export"},n.prototype.events={"click @ui.formSubmit":"showSaving"},n.prototype.modelEvents={"change:edit":"render",save:"onSave",destroy:function(){return this.triggerMethod("dialog:close")}},n.prototype.childEvents={"form:key:enter":"onFormKeyEnter"},n.prototype.initialize=function(){return Mn.bindEntityEvents(this.model,this,this.model.viewEvents)},n.prototype.serializeData=function(){return _.extend({},n.__super__.serializeData.apply(this,arguments),{lists:r.datapoints.types})},n.prototype._deleteModalCfg=function(){var t,e;return e={name:this.model.get("fn")},t={event:"delete",title:l("card confirm delete title",e),message:l("card confirm delete message",e),btn_ok:l("card confirm delete ok"),btn_cancel:l("card confirm delete cancel")}},n.prototype.onRender=function(){return this.showChildView("avatar",new o({model:this.model})),this.showChildView("infos",new a({model:this.model})),this.showChildView("tags",new s({model:this.model})),this.$('[role="contentinfo"]').toggleClass("edit",!!this.model.get("edit"))},n.prototype.onDomRefresh=function(){return this.model.get("edit")?void 0:this.ui.btnEdit.trigger("focus")},n.prototype.onSave=function(){var t,n;if(this.model.get("new"))return t=e("application"),n="contacts/"+this.model.get("id"),this.hideSaving(),t.router.navigate(n,{trigger:!0})},n.prototype.onEditCancel=function(){return this.model.get("new")?this.triggerMethod("dialog:close"):void 0},n.prototype.onFormKeyEnter=function(){var t;return t=this.$(".data.edit").find('input:not([type="hidden"]), textarea'),"textarea"!==document.activeElement.tagName.toLowerCase()?t.eq(t.index(document.activeElement)+1).trigger("focus"):void 0},n.prototype.showSaving=function(){return this.ui.formSubmit.attr("aria-busy",!0)},n.prototype.hideSaving=function(){return this.ui.formSubmit.attr("aria-busy",!1)},n}(Mn.LayoutView)}),require.register("views/contacts/components/avatar",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.template=e("views/templates/contacts/components/avatar"),n.prototype.behaviors={PickAvatar:{}},n.prototype.ui=function(){return this.options.model.get("edit")?{avatar:".avatar"}:void 0},n.prototype.modelEvents={"change:n":"updateInitials","change:avatar":"render"},n.prototype.getInitialsColor=function(){return ColorHash.getColor(this.model.get("n"),"cozy")},n.prototype.serializeData=function(){return _.extend({},n.__super__.serializeData.apply(this,arguments),{bg:this.getInitialsColor()})},n.prototype.updateInitials=function(t,e){var n;return n=this.el.querySelector(".initials"),n?(n.innerHTML=this.model.get("initials"),n.style["background-color"]=this.getInitialsColor()):void 0},n}(Mn.ItemView)}),require.register("views/contacts/components/data",function(t,e,n){var o,r,i,a,s,l=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty,u=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};i=e("views/contacts/components/datapoints"),s=e("views/contacts/components/xtras"),a=e("views/contacts/components/edit_actions"),o=e("config").contact,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.template=e("views/templates/contacts/components/data"),n.prototype.behaviors={Form:{}},n.prototype.ui={formAdd:".actions button"},n.prototype.modelEvents={change:function(){return this.model.get("edit")?void 0:this.render()}},n.prototype.childEvents={"form:key:enter":function(){return this.triggerMethod("form:key:enter")}},n.prototype.initialize=function(){return Mn.bindEntityEvents(this.model,this,this.model.viewEvents)},n.prototype.serializeData=function(){return _.extend({},n.__super__.serializeData.apply(this,arguments),{fullname:this.model.toString({pre:"<b>",post:"</b>"})})},n.prototype._renderDatapoints=function(){return this.$(".datapoints").each(function(t){return function(e,n){var o;return o=n.dataset.type,t.addRegion(o,"[data-type='"+o+"']"),t.showChildView(o,new i({collection:t.model.getDatapoints(o),name:o,cardViewModel:t.model}))}}(this)),this.addRegion("xtras-infos",'[data-type="xtras-infos"]'),this.showChildView("xtras-infos",new s({model:this.model}))},n.prototype._renderEditActions=function(){return this.addRegion("actions",".actions"),this.showChildView("actions",new a({model:this.model}))},n.prototype.onRender=function(){return this._renderDatapoints(),this.model.get("edit")?this._renderEditActions():void 0},n.prototype.onDomRefresh=function(){return this.model.get("edit")?this.$('input:not([type="hidden"])').eq(1).trigger("focus"):void 0},n.prototype.onFormFieldAdd=function(t){var e;return e=this.getRegion("xtras").currentView,u.call(o.xtras,t)<0?e.addEmptyField(t):void 0},n}(Mn.LayoutView)}),require.register("views/contacts/components/datapoint",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=e("config").contact,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.tagName=function(){return this.options.cardViewModel.get("edit")?"div":"li"},n.prototype.className="group",n.prototype.attributes=function(){return{"data-cid":this.model.cid}},n.prototype.template=e("views/templates/contacts/components/datapoint"),n.prototype.ui={type:"input.type"},n.prototype.events=function(){return"xtras"===this.options.name?{"keyup @ui.type":_.debounce(this.updateType,250),"change @ui.type":this.updateType}:void 0},n.prototype.serializeData=function(){var t,e;return t=this.model.toJSON(),e=function(){switch(t.name){case"social":case"chat":return"social";case"url":return null!=t.mediatype&&t.mediatype.search(!0)?"share":"url";case"share":return"share";default:return"default"}}(),null==t.type&&(t.type=o.datapoints.types[e][0].split(":")[0]),{edit:this.options.cardViewModel.get("edit"),ref:this.options.cardViewModel.get("ref"),name:this.options.name,index:this.options.index,entity:e,point:t}},n.prototype.updateType=function(t){var e,n,r;return n=this.model.get("name"),"url"!==n&&"share"!==n?(e=_.find(o.datapoints.types.social,function(e){return e.match(new RegExp("^"+t.currentTarget.value.toLowerCase()))}),e?(r=e.split(":"),n=r[r.length-1]):n="other",this.$(t.currentTarget).siblings(".name").val(n)):void 0},n}(Mn.ItemView)}),require.register("views/contacts/components/datapoints",function(t,e,n){var o,r,i,a,s=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=e("lib/i18n"),r=e("views/contacts/components/datapoint"),o=e("config").contact,n.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.tagName=function(){return this.options.cardViewModel.get("edit")?"fieldset":"ul"},e.prototype.template=function(t){var e;return t.edit?(e=a("datapoints section "+t.name),"<legend>"+e+"</legend>"):void 0},e.prototype.behaviors={Form:{}},e.prototype.ui=function(){var t;return t={formInputs:"input, textarea",formDelete:"button.delete"},"xtras"!==this.options.name&&(t.formAutoAdd=".value"),t},e.prototype.childView=r,e.prototype.childViewOptions=function(t,e){return _.extend(_.pick(this.options,"name","cardViewModel"),{index:e})},e.prototype.initialize=function(){return this.options.cardViewModel.get("edit")?this._initializeEditMode():void 0},e.prototype.serializeData=function(){return{name:this.options.name,edit:this.options.cardViewModel.get("edit")}},e.prototype._initializeEditMode=function(){return"xtras"!==this.options.name?this.addEmptyField():void 0},e.prototype.onFormFieldAdd=function(t){return this.addEmptyField(t)},e.prototype.onFormFieldUpdate=function(t){var e,n,o;return e=this.$(t).parents("[data-cid]"),o=this.collection.get(e.data("cid")),n=_.reduce(e.find("input, textarea"),function(t,e){
return t[_.last(e.name.split("."))]=e.value,t},{}),o.set(n)},e.prototype.onFormFieldDelete=function(t){return this.collection.remove(t)},e.prototype.getDatapoints=function(){return this.collection.filter(function(t){return!_.isEmpty(t.get("value"))})},e.prototype.addEmptyField=function(t){var e;return e=this.collection.add({type:void 0,value:"",name:t||this.options.name}),c.call(o.datapoints.main,t)>=0?void 0:this.$("[data-cid='"+e.cid+"'] input.value").trigger("focus")},e}(Mn.CompositeView)}),require.register("views/contacts/components/edit_actions",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.tagName="dl",n.prototype.attributes={"aria-haspopup":!0,"aria-expanded":!1,"data-position":"top left"},n.prototype.template=e("views/templates/contacts/components/add_field_dropdown"),n.prototype.modelEvents={"change:bday":"render"},n}(Mn.ItemView)}),require.register("views/contacts/components/edit_tags",function(t,e,n){var o,r,i,a,s=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;r=BackboneProjections.Filtered,i=e("views/contacts/components/tag"),a=void 0,n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.tagName="dl",n.prototype.attributes={"aria-haspopup":!0,"aria-expanded":!1,"data-position":"bottom right"},n.prototype.template=e("views/templates/contacts/components/edit_tags"),n.prototype.childView=i,n.prototype.childViewOptions=function(t){return{contactViewModel:this.model}},n.prototype.childViewContainer="ul",n.prototype.ui={tags:"li:not(.create) input",create:".create",dropdown:"dd"},n.prototype.events={"change @ui.tags":"onClickTag","click @ui.dropdown":function(t){return t.stopPropagation()},"click @ui.create button":"toggleCreate",'keydown @ui.create [name="name"]':"addNewTag"},n.prototype.modelEvents={"change:tags":function(t){return this.toggleCreate(!1),this.children.invoke("render")}},n.prototype.initialize=function(){return a=e("application"),this.collection=new r(a.tags,{filter:function(t){return null!=a.contacts.tagMap[t.get("name")]}}),Mn.bindEntityEvents(this.model,this,this.model.viewEvents)},n.prototype.onClickTag=function(t){var e;return e=this.$("li:not(.create) input").serializeArray().map(function(t){return a.tags.get(t.value).get("name")}),this.triggerMethod("tags:update",e)},n.prototype.toggleCreate=function(t){return(_.isNull(t)||!_.isBoolean(t))&&(t="true"!==this.ui.create.attr("aria-expanded")),this.ui.create.attr("aria-expanded",t),this.ui.create.find('[name="name"]').val(""),t?this.ui.create.find('input[name="name"]').trigger("focus"):void 0},n.prototype.addNewTag=function(t){var e;return t.stopPropagation(),e=t.currentTarget.value,13!==t.which||_.isEmpty(e)?void 0:this.triggerMethod("tags:add",e)},n}(Mn.CompositeView)}),require.register("views/contacts/components/tag",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.tagName="li",n.prototype.template=e("views/templates/contacts/components/tag"),n.prototype.serializeData=function(){var t;return t=this.options.contactViewModel.get("tags"),_.extend({},n.__super__.serializeData.apply(this,arguments),{selected:_.includes(t,this.model.get("name"))})},n}(Mn.ItemView)}),require.register("views/contacts/components/xtras",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].slice;o=e("config").contact,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.tagName=function(){return this.model.get("edit")?"fieldset":"ul"},n.prototype.template=e("views/templates/contacts/components/xtras"),n.prototype.modelEvents=function(){return _.reduce(o.xtras,function(t,e){return t["change:"+e]=function(){var t;return t=1<=arguments.length?s.call(arguments,0):[],this.render.apply(this,t),this.setFocus.apply(this,t)},t},{})},n.prototype.serializeData=function(){return{edit:this.model.get("edit"),ref:this.model.get("ref"),xtras:_.reduce(o.xtras,function(t){return function(e,n){return t.model.has(n)&&(e[n]=t.model.get(n)),e}}(this),{})}},n.prototype.setFocus=function(t){var e,n;return n=this.model.get("ref"),e=_.keys(t.changed)[0],this.$("#"+e+"-"+n).trigger("focus")},n}(Mn.ItemView)}),require.register("views/contacts/index",function(t,e,n){var o,r,i,a,s,l,c=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;r=e("views/models/contact"),o=e("views/contacts/row"),a=Backbone.Collection,l=e("config").indexes,s=void 0,n.exports=i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return c(n,t),n.prototype.sort=!1,n.prototype.tagName=function(){var t,n;return t=e("application").model,t.get("scored")?"ul":(null!=(n=this.model)?n.has("char"):void 0)?"dl":"div"},n.prototype.attributes=function(){var t,n;return t=e("application").model,t.get("scored")||(null!=(n=this.model)?n.has("char"):void 0)?{role:"rowgroup"}:void 0},n.prototype.template=e("views/templates/contacts"),n.prototype.events=function(){return null==this.model?{'change [type="checkbox"]':"updateBulkSelection"}:void 0},n.prototype.attachElContent=function(t){return this.el.innerHTML=t,this},n.prototype.attachBuffer=function(t,e){var n,o;return o=Mn._getValue(this.childViewContainer,this),n=_.isString(o)?this.el.querySelector(o):this.el,n.appendChild(e)},n.prototype.buildChildView=function(t){var e;return new(e=this._hasContacts?o:this.constructor)({model:t})},n.prototype.showCollection=function(){var t,e,n;return e=0,n=this._getModels(),setTimeout(t=function(o){return function(){var r,i;return r=n[e],n.length&&r?(i=o.buildChildView(r),o._updateIndices(i,!0,e),o.children.add(i),o.renderChildView(i,e),i._parent=o,e++,setTimeout(t)):o.trigger("show:collection")}}(this))},n.prototype._createBuffer=function(){return document.createDocumentFragment()},n.prototype._onCollectionRemove=function(t){var e,n;return e=t.model,n=this.children.find(function(t){return t.model.model===e}),this.removeChildView(n),this.checkEmpty(),this.toggleEmpty()},n.prototype._onCollectionAdd=function(t,e,n){var o;return this.destroyEmptyView(),o=this.getChildView(t),this.addChild(t,o,n.index),this.toggleEmpty()},n.prototype._getModels=function(){var t;return t="scored"===this._mode?s.get():this._hasContacts?s.get({index:this.model.get("char")}):this.collection.models},n.prototype.initialize=function(){var t,n,o,r;return o=e("application"),n=o.model,s=o.filtered,this._mode=n.get("scored")?"scored":"indexed",this._hasContacts=(null!=(r=this.model)?r.has("char"):void 0)||"scored"===this._mode,this._hasContacts&&"indexed"===this._mode?(t=this.model.get("char"),this.collection=Backbone.Radio.channel("idx."+t),this.childViewContainer="ul"):"indexed"!==this._mode||this._hasContacts||(this.collection=new a(Array.prototype.map.call(l,function(t){return{"char":t}})),this.once("show:collection",function(){return e("application").channel.trigger("busy:disable")})),this._hasContacts&&(this.sort=!0,this.listenTo(this.collection,{reset:this.updateTagClasses,update:this.updateTagClasses,"change:tags":this.updateTagClasses})),"scored"===this._mode&&this.listenTo(n,{"change:filter":function(){return this.children.invoke("highlight")}}),"indexed"===this._mode?this.listenTo(n,{"change:scored":this.toggleEvents}):void 0},n.prototype.toggleEvents=function(t,e){return e?(this.stopListening(this.collection,"add"),this.stopListening(this.collection,"remove"),this.stopListening(this.collection,"reset"),this._hasContacts?this.stopListening(this.collection,"sort"):void 0):setTimeout(function(t){return function(){return t._initialEvents(),t.updateTagClasses()}}(this))},n.prototype.toggleEmpty=function(){return this.el.classList.toggle("empty",!this._getModels().length)},n.prototype.updateTagClasses=function(){var t,e;return e=_.chain(s.get({index:null!=(t=this.model)?t.get("char"):void 0})).invoke("get","tags").flatten().compact().map(function(t){return"tag_"+t}).join(" ").value(),e.length?this.el.className=e:this.el.removeAttribute("class"),this.toggleEmpty()},n.prototype.updateBulkSelection=function(t){var e,n,o;return o=t.currentTarget.checked,e=t.currentTarget.value,n=o?"contacts:select":"contacts:unselect",this.triggerMethod(n,e)},n.prototype.onRender=n.prototype.updateTagClasses,n}(Mn.CompositeView)}),require.register("views/contacts/merge",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("lib/i18n"),n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.template=e("views/templates/contacts/merge"),n.prototype.tagName="section",n.prototype.className="merge",n.prototype.attributes={role:"alertdialog"},n.prototype.behaviors={Dialog:{},Form:{}},n.prototype.ui={formSubmit:'[type="submit"]',formInputs:"input",cancel:".cancel"},n.prototype.modelEvents={"contacts:merge":"onClose"},n.prototype.events={"click @ui.cancel":"onCancel"},n.prototype.initialize=function(){return Mn.bindEntityEvents(this.model,this,this.model.viewEvents)},n.prototype.serializeData=function(){return{model:this.model.toJSON()}},n.prototype.onDomRefresh=function(){return _.defer(function(t){return function(){return t.$el.attr("aria-busy",!0)}}(this))},n.prototype.onFormSubmit=function(){return this.model.merge(),this.onClose()},n.prototype.onCancel=function(){return this.model.trigger("contacts:merge",this.model,"abort")},n.prototype.onClose=function(){return e("application").layout.alerts.empty()},n}(Mn.ItemView)}),require.register("views/contacts/row",function(t,e,n){var o,r,i,a=function(t,e){return function(){return t.apply(e,arguments)}},s=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};r=e("config").search.pattern("text"),i=void 0,n.exports=o=function(t){function n(){return this.lazyLoadAvatar=a(this.lazyLoadAvatar,this),n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.supportsRenderLifecycle=!1,n.prototype.tagName="li",n.prototype.attributes={role:"row"},n.prototype._format={pre:"<b>",post:"</b>"},n.prototype._isAvatarLoaded=!1,n.prototype.initialize=function(){return i=e("application"),this.listenTo(this.model,{change:this.render}),this.listenTo(i.model,{"change:selected":this.refreshChecked})},n.prototype.render=function(){var t,n,o,r;return n=this.el,t=this.serializeData(),n.className=null!=(o=this.model.get("tags"))?o.map(function(t){return"tag_"+t}).join(" "):void 0,r=e("views/templates/contacts/row"),n.innerHTML=r(t),window.requestAnimationFrame(this.lazyLoadAvatar),this.highlight()},n.prototype.serializeData=function(){var t;return _.extend(this.model.toJSON(),{selected:(t=this.model.id,c.call(i.model.get("selected"),t)>=0),fullname:this.model.toString(this._format),isAvatarLoaded:this._isAvatarLoaded})},n.prototype.highlight=function(){var t,e,n;return(t=null!=(n=i.model.get("filter"))?n.match(r):void 0)?(e=this.model.toHighlightedString(t[1],{pre:'<span class="search">',post:"</span>",format:this._format}),this.el.querySelector(".name p").innerHTML=e):void 0},n.prototype.refreshChecked=function(t,e){var n;return this.$('[type="checkbox"]').prop("checked",(n=this.model.id,c.call(e,n)>=0))},n.prototype.lazyLoadAvatar=function(){var t,e,n,o;if(!this._isAvatarLoaded)return t=document.documentElement,e=this.el.querySelector("img.avatar"),o=this.el.getBoundingClientRect(),n=o.top<=(window.innerHeight||t.clientHeight),n&&e?(e.setAttribute("src",e.dataset.src),this._isAvatarLoaded=!0):window.requestAnimationFrame(this.lazyLoadAvatar)},n}(Backbone.View)}),require.register("views/duplicates/index",function(t,e,n){var o,r,i,a,s=function(t,e){function n(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;r=e("collections/duplicates"),a=e("lib/i18n"),o=e("config").contact,n.exports=i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,t),n.prototype.template=e("views/templates/duplicates"),n.prototype.tagName="section",n.prototype.className="duplicates",n.prototype.attributes={role:"dialog"},n.prototype.childViewContainer='[role="grid"]',n.prototype.childView=e("views/duplicates/row"),n.prototype.templateHelpers=function(){return{size:this.toMerge.size()}},n.prototype.behaviors={Dialog:{}},n.prototype.collectionEvents={"contacts:merge":"render"},n.prototype.initialize=function(){var t;return t=e("application").contacts,this.collection=new r(null,{collection:t}),this.toMerge=new BackboneProjections.Filtered(this.collection,{filter:function(t){return t.isMergeable()}}),this.bindEntityEvents(this.collection,this.getOption("collectionEvents"))},n}(Mn.CompositeView)}),require.register("views/duplicates/row",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,s=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=e("views/models/contact"),n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.template=e("views/templates/duplicates/row"),n.prototype.tagName=function(){return this.model.has("result")?"div":"dl"},n.prototype.className=function(){return this.model.has("result")?"merged":""},n.prototype.attributes=function(){return{role:this.model.has("result")?"row":"rowgroup"}},n.prototype.ui={submit:'[type="submit"]',dismiss:".cancel"},n.prototype.modelEvents={change:"render","contacts:merge":"onContactsMerge"},n.prototype.events={"click @ui.submit":"merge",'click [type="checkbox"]':"check","click @ui.dismiss":"dismiss"},n.prototype.serializeData=function(){var t;return t=this.model.has("result")?new o({"new":!1},{model:this.model.get("result")}):void 0,_.extend(n.__super__.serializeData.apply(this,arguments),{candidates:this.model.get("candidates").map(function(t){return new o({"new":!1},{model:t})}),selected:this.model.get("candidates").map(function(t){return function(e){return s.call(t.model.get("toMerge"),e)>=0}}(this)),isMergeable:this.model.isMergeable(),result:t,merging:this.merging})},n.prototype.check=function(t){var e;return e=$(t.target),this.model.selectCandidate(e.val(),e.is(":checked"))},n.prototype.dismiss=function(){return this.model.collection.remove(this.model)},n.prototype.onContactsMerge=function(){return this.merging=!1,this.render()},n.prototype.merge=function(){var t,n,o;return this.triggerMethod("merge"),this.merging=!0,this.$("button, input").prop("disabled",!0),_.defer(function(t){return function(){return t.ui.submit.attr("aria-busy",!0)}}(this)),o=this.model.buildMergeOptions(),0===Object.keys(o).length?this.model.merge():(t=e("views/contacts/merge"),n=e("application").layout,n.showChildView("alerts",new t({model:this.model})))},n}(Mn.ItemView)}),require.register("views/labels/filter",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.template=e("views/templates/labels/filter"),n.prototype.tagName="li",n.prototype.serializeData=function(){var t,o,r,i;return t=e("application"),r=new RegExp("tag:"+this.model.get("name"),"i"),o=null!=(i=t.model.get("filter"))?i.match(r):void 0,_.extend({},n.__super__.serializeData.apply(this,arguments),{selected:!!o})},n}(Mn.ItemView)}),require.register("views/labels/index",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=BackboneProjections.Filtered,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.template=e("views/templates/labels"),n.prototype.tagName="fieldset",n.prototype.ui={navigate:"a"},n.prototype.behaviors={Navigator:{}},n.prototype.childViewContainer="ul",n.prototype.childView=e("views/labels/filter"),n.prototype.initialize=function(){var t;return t=e("application"),this.collection=new o(t.tags,{filter:function(e){return null!=t.contacts.tagMap[e.get("name")]}}),this.collection.listenTo(t.contacts,{reset:this.collection.update,update:this.collection.update,"change:tags":this.collection.update}),this.listenTo(t.channel,{"filter:tag":this.toggleSelected})},n.prototype.toggleSelected=function(t){var e;return e=t?"[href$='/"+t+"']":":first",this.$("a:not("+e+")").attr("aria-checked",!1).find("input").prop("checked",!1),this.$("a"+e).attr("aria-checked",!0).find("input").prop("checked",!0)},n}(Mn.CompositeView)}),require.register("views/models/app",function(e,n,o){var r,i,a,s,l,c=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=n("views/contacts/merge"),i=n("views/models/merge"),l=n("lib/request"),s=void 0,o.exports=r=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return c(o,e),o.prototype.defaults={dialog:!1,filter:void 0,scored:!1,errors:void 0},o.prototype.viewEvents={"settings:sort":"updateSortSetting","settings:upload":"onUploadFile","select:all":"selectAll","select:none":"unselectAll","bulk:delete":"bulkDelete","bulk:export":function(){return this.bulkExport()},"bulk:merge":"bulkMerge","contacts:export":function(){return this.bulkExport(!0)}},o.prototype.initialize=function(){return s=n("application"),this.set("selected",[]),this.listenTo(this,"change:filter",function(t,e){return this.unselectAll(),this.set("scored",n("config").search.pattern("text").test(e))})},o.prototype.select=function(t){var e;return e=this.attributes.selected.slice(0),e.push(t),this.set({selected:e})},o.prototype.unselect=function(t){var e;return e=_.without(this.attributes.selected,t),this.set({selected:e})},o.prototype.selectAll=function(){var t;return t=s.filtered.get({tagged:!0}).map(function(t){return t.id}),this.set({selected:t})},o.prototype.unselectAll=function(){return this.set({selected:[]})},o.prototype.bulkDelete=function(){var e;return e=this.attributes.selected,s.contacts.contactListener.disable(),l.post("/contacts/bulk-delete",e,function(n){return function(o,r){return o?(console.log(o),alert(t("contacts delete bulk error"))):(s.contacts.remove(e,{sort:!1}),n.set({selected:[]}),setTimeout(s.contacts.contactListener.enable,1500),n.trigger("bulk:delete:done"))}}(this))},o.prototype.bulkMerge=function(){var t,e,n;return t=s.contacts.filter(function(t){return function(e){var n;return n=e.id,p.call(t.attributes.selected,n)>=0}}(this)),n=new i({candidates:t}),e=n.buildMergeOptions(),n.on("contacts:merge",function(t){return function(e,o){return t.unselectAll(),"abort"!==o?t.select(n.get("result").id):void 0}}(this)),0===Object.keys(e).length?n.merge():s.layout.showChildView("alerts",new a({model:n}))},o.prototype.bulkExport=function(t){var e,n,o,r;return o=this.attributes.selected,e=t?s.contacts.size():o.length,r=[],n=_.after(e,function(){var t,e;return e=moment().format("YYYYMMDD"),t=new Blob(r,{type:"text/plain;charset=utf-8"}),saveAs(t,e+"_cozy_contacts_"+r.length+".vcf")}),s.contacts.chain().filter(function(e){var n;return t||(n=e.id,p.call(o,n)>=0)}).invoke("toVCF",function(t){return r.push(t),n()}).value()},o.prototype.updateSortSetting=function(t){return this.model.save("sort",t)},o.prototype.onUploadFile=function(t){var e;return/.+\.(vcf|vcard)$/i.test(t.name)?(this.trigger("before:import"),e=new FileReader,e.readAsText(t),e.onloadend=function(t){return function(){var n,o;return o=e.result,n=/^BEGIN:VCARD/,n.test(o)?s.contacts.importFromVCF(o):t.set("errors",{upload:"error upload wrong filetype"})}}(this)):this.set("errors",{upload:"error upload wrong filetype"})},o}(Backbone.ViewModel)}),require.register("views/models/contact",function(t,e,n){var o,r,i,a,s,l=function(t,e){function n(){this.constructor=t}for(var o in e)c.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty,u=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};a=BackboneProjections.Filtered,r=e("config").contact,o=e("lib/contact_helper"),s=null,n.exports=i=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.defaults={"new":!1,edit:!1},n.prototype.map={avatar:"_attachments",name:"n"},n.prototype.events={"before:save":"syncDatapoints",save:"onSave",reset:"onReset"},n.prototype.viewEvents={"edit:cancel":"reset","tags:update":"updateTags","tags:add":"addNewTag","form:field:add":"onAddField","form:submit":_.ary(n.prototype.save,0),"export":"downloadAsVCF","delete":_.ary(n.prototype.destroy,0)},n.prototype.proxy=["toString","toHighlightedString","match"],n.prototype.initialize=function(){return s=e("application"),this._setRef(),this.getDatapoints=_.memoize(this.getDatapoints,function(t){return this.attributes.edit?"edit-"+t:t}),this.listenTo(this,"change:edit",function(t,e){var n,o,r;if(e){n=this.getDatapoints.cache,r=[];for(o in n)/^edit/.test(o)&&r.push(delete n[o]);return r}})},n.prototype.toJSON=function(){var t;return t=n.__super__.toJSON.apply(this,arguments),delete t.datapoints,t.xtras=this.getDatapoints("xtras").toJSON(),_.reduce(r.datapoints.main,function(t){return function(e,n){return e[n]=t.getDatapoints(n).toJSON(),e}}(this),t)},n.prototype.getMappedAvatar=function(t){return(null!=t?t.picture:void 0)?"contacts/"+this.model.id+"/picture.png?revpos="+t.picture.revpos:null},n.prototype.saveMappedAvatar=function(){var t,e;return t={},e=this.get("avatar"),null!=e&&null==e.match(/contacts\/.+\/picture.png/)&&(t.avatar=e.split(",")[1]),t},n.prototype.getMappedName=function(t){var e,n,o,r,i,a,s;return a=t.split(";"),n=a[0],e=a[1],o=a[2],i=a[3],s=a[4],r={first:e,given:n},o&&(r.middle=o),i&&(r.prefix=i),s&&(r.suffix=s),r},n.prototype.saveMappedName=function(){var t,e;return e=_.clone(this.get("name")),(t={}).n=[e.given,e.first,e.middle,e.prefix,e.suffix].join(";"),t},n.prototype._setRef=function(){return this.set("ref",this.model.cid)},n.prototype.getIndexKey=function(){var t,e,n;return n="fn"===s.model.get("sort")?0:1,t=(null!=(e=this.get("initials")[n])?e.toLowerCase():void 0)||"",/[a-z]/.test(t)?t:"#"},n.prototype.onAddField=function(t){return u.call(r.xtras,t)>=0?this.set(t,""):void 0},n.prototype.getDatapoints=function(t){var e,n;return e=function(e){var n;return u.call(r.datapoints.main,t)>=0?e.get("name")===t:(n=e.get("name"),u.call(r.datapoints.main,n)<0)},this.attributes.edit?(n=this.model.get("datapoints").filter(e).map(function(t){return t.clone()}),new Backbone.Collection(n)):new a(this.model.get("datapoints"),{filter:e})},n.prototype.syncDatapoints=function(){var t,e,n,r,i,a;t=this.getDatapoints.cache,n=this.model.get("datapoints"),i=[],a=t.__data__;for(r in a)e=a[r],/^edit/.test(r)&&(i=i.concat(o.getNonEmptyDatapoints(e)));return n.reset(i)},n.prototype.updateTags=function(t){return null!=this.model.id?this.model.save({tags:t}):this.model.set({tags:t})},n.prototype.addNewTag=function(t){var e,n;return e=s.contacts,n=s.tags,e.tagMap[t]=!0,n.create({name:t},{wait:!0,success:function(e){return function(){return n=e.model.get("tags").concat(t),e.updateTags(n)}}(this)})},n.prototype.onSave=function(){return this.get("new")?s.contacts.add(this.model):void 0},n.prototype.onReset=function(){return this._setRef()},n.prototype.downloadAsVCF=function(){var t;return t=this.model.get("fn"),this.model.toVCF(function(e){var n;return n=new Blob([e],{type:"text/plain;charset=utf-8"}),saveAs(n,t+".vcf")})},n}(Backbone.ViewModel)}),require.register("views/models/merge",function(t,e,n){var o,r,i,a,s,l,c=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty,p=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};i=e("models/contact"),s=e("views/models/contact"),r=e("lib/compare_contacts"),a=e("lib/contact_helper"),o=["org","title","department","bday","nickname"],n.exports=l=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return c(n,t),n.prototype.initialize=function(t){return null!=t.candidates?this.set("toMerge",t.candidates.slice(0)):void 0},n.prototype.selectCandidate=function(t,e){return e?this.isCandidateSelected(t)||this.attributes.toMerge.push(this.get("candidates")[t]):this.unselectCandidate(t),this.trigger("change",this)},n.prototype.unselectCandidate=function(t){return this.attributes.toMerge=this.attributes.toMerge.filter(function(e){return function(n){return n!==e.get("candidates")[t]}}(this))},n.prototype.isCandidateSelected=function(t){var e;return e=this.get("candidates")[t],p.call(this.get("toMerge"),e)>=0},n.prototype.toMergeAsJson=function(){return this.get("toMerge").map(function(t){return t.toJSON()})},n.prototype.isMergeable=function(){return!this.has("result")&&this.get("toMerge").length>1},n.prototype.buildMergeOptions=function(){var t,e,n,r,i,a;for(i={},e=o.concat(["avatar","fullname"]),n=0,r=e.length;r>n;n++)t=e[n],a=[],this.get("toMerge").forEach(function(e,n){var o,r;return r="avatar"===t?e.has("_attachments")?"contacts/"+e.get("id")+"/picture.png":null:"fullname"===t?e.toString({pre:"<b>",post:"</b>"}):e.get(t),o=function(t){return t.value===r},null==r||""===r||a.some(o)?void 0:a.push({value:r,index:n})}),a.length>0&&this.set(t,a[0].index),a.length>1&&(i[t]=a);return this.set("mergeOptions",i),i},n.prototype.merge=function(t){var e,n,s,l,c,u,p,d,f;if(d=this.toMergeAsJson(),d.length<=1)return t(new Error("not enought contact to merge."));for(u={datapoints:[],tags:[]},d.forEach(function(t){return r.mergeContacts(u,t)}),delete u._id,delete u.id,delete u.revision,delete u._rev,delete u._attachments,s=o,this.has("fullname")&&(this.set("n",this.get("fullname")),this.set("fn",this.get("fullname")),s=s.concat(["n","fn"])),l=0,c=s.length;c>l;l++)n=s[l],this.has(n)&&(u[n]=d[this.get(n)][n]);return p=new i(u,{parse:!0}),e=function(e){return function(n){return n?t(n):(e.listenToOnce(p,"sync",e.afterSyncResult.bind(e)),p.save(),null!=t?t():void 0)}}(this),this.has("avatar")?(f="contacts/"+d[this.get("avatar")].id+"/picture.png",a.imgUrl2DataUrl(f,function(t,n){return p.set("avatar",n.split(",")[1]),e(t)})):e()},n.prototype.afterSyncResult=function(t){return async.each(this.get("toMerge"),function(t,e){return t.destroy({success:function(){return e()},error:function(t,n,o){return e(n)}})},function(n){return function(o){var r;return o?(console.error(o),n.trigger("contacts:merge",n,o)):(n.attributes.toMerge=[],n.attributes.candidates=[],n.set("result",t),n.trigger("contacts:merge",n,null)),r=e("application").contacts,r.add(t,{sort:!1})}}(this))},n}(Backbone.ViewModel)}),require.register("views/settings/index",function(t,e,n){var o,r,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=e("config").settings,i=e("lib/i18n"),n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.template=e("views/templates/settings"),n.prototype.tagName="section",n.prototype.className="settings",n.prototype.attributes={role:"dialog"},n.prototype.behaviors={Dialog:{}},n.prototype.ui={sort:'[name="sort"]',"import":"button.import",upload:'[type="file"]',"export":'[formaction="contacts/export"]',feedback:".feedback"},n.prototype.triggers={"click @ui.export":"contacts:export"},n.prototype.events={"change @ui.sort":"updateSort","click @ui.import":"triggerUploader","change @ui.upload":"onUploadFile"},n.prototype.modelEvents={"change:errors":"render","before:import":"onBeforeImport"},n.prototype.initialize=function(){return Mn.bindEntityEvents(this.model,this,this.model.viewEvents),this.listenTo(e("application").contacts,{"before:import:progress":this.onBeforeImportProgress,"import:progress":this.onProgressImport,"import":this.onProgressEnd})},n.prototype.serializeData=function(){return _.extend({},n.__super__.serializeData.apply(this,arguments),r,{locale:e("imports").locale})},n.prototype.updateSort=function(t){return t.preventDefault(),t.stopPropagation(),this.triggerMethod("settings:sort",t.currentTarget.value)},n.prototype.triggerUploader=function(t){return t.preventDefault(),t.stopPropagation(),this.ui.upload.trigger("click")},n.prototype.onUploadFile=function(t){return t.preventDefault(),t.stopPropagation(),this.triggerMethod("settings:upload",t.currentTarget.files[0])},n.prototype.onBeforeImport=function(){return this.ui["import"].prop("disabled",!0),this.ui.feedback.empty()},n.prototype.onBeforeImportProgress=function(t){var e;return this.ui.progress=$("<progress/>",{max:t,value:0}),this.ui.counter=$("<span/>",{text:0}),e=$("<div/>",{text:"/"+t}).prepend(this.ui.counter),this.ui.progress.appendTo(this.ui.feedback),e.appendTo(this.ui.feedback)},n.prototype.onProgressImport=function(t){return this.ui.progress.val(t),this.ui.counter.text(t)},n.prototype.onProgressEnd=function(t){return this.ui.feedback.empty().text(i("settings in-out import result",{smart_count:t})),this.ui["import"].prop("disabled",!1)},n}(Mn.ItemView)}),require.register("views/templates/contacts/card",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e,r,i,a,s){o.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo">'),r&&function(){var t=a;if("number"==typeof t.length)for(var e=0,n=t.length;n>e;e++){var r=t[e];o.push("<datalist"+jade.attr("id","list-"+e,!0,!1)+">"),function(){var t=r;if("number"==typeof t.length)for(var e=0,n=t.length;n>e;e++){var i=t[e],a=i.split(":");o.push("<option"+jade.attr("value",a[0],!0,!1)+jade.attr("data-name",a[1],!0,!1)+"></option>")}else{var n=0;for(var e in t){n++;var i=t[e],a=i.split(":");o.push("<option"+jade.attr("value",a[0],!0,!1)+jade.attr("data-name",a[1],!0,!1)+"></option>")}}}.call(this),o.push("</datalist>")}else{var n=0;for(var e in t){n++;var r=t[e];o.push("<datalist"+jade.attr("id","list-"+e,!0,!1)+">"),function(){var t=r;if("number"==typeof t.length)for(var e=0,n=t.length;n>e;e++){var i=t[e],a=i.split(":");o.push("<option"+jade.attr("value",a[0],!0,!1)+jade.attr("data-name",a[1],!0,!1)+"></option>")}else{var n=0;for(var e in t){n++;var i=t[e],a=i.split(":");o.push("<option"+jade.attr("value",a[0],!0,!1)+jade.attr("data-name",a[1],!0,!1)+"></option>");
}}}.call(this),o.push("</datalist>")}}}.call(this),o.push('<div role="img"></div><div class="data"></div><aside><ul>'),r?(i?o.push('<li><button type="submit"'+jade.attr("data-next","contacts/"+e,!0,!1)+' class="outline"><i class="fa fa-check"></i><span>'+jade.escape(null==(n=t("card actions save"))?"":n)+"</span></button></li>"):o.push('<li><button type="submit" class="outline"><i class="fa fa-plus"></i><span>'+jade.escape(null==(n=t("card actions create"))?"":n)+"</span></button></li>"),o.push('<li><a role="button"'+jade.attr("href",i?"contacts/"+e:"contacts",!0,!1)+jade.attr("data-confirm",'{"event":"edit:cancel","title":"'+t("card confirm cancel title")+'","message":"'+t("card confirm cancel message")+'","btn_ok":"'+t("card confirm cancel ok")+'","btn_cancel":"'+t("card confirm cancel cancel")+'"}',!0,!1)+' class="cancel outline secondary"><i class="fa fa-times"></i><span>'+jade.escape(null==(n=t("card actions cancel"))?"":n)+"</span></a></li>")):o.push('<li><a role="button"'+jade.attr("href","contacts/"+e+"/edit",!0,!1)+' class="edit outline secondary"><i class="fa fa-pencil"></i><span>'+jade.escape(null==(n=t("card actions edit"))?"":n)+'</span></a></li><li><button formaction="contact/export" class="outline secondary"><i class="fa fa-upload"></i><span>'+jade.escape(null==(n=t("card actions export"))?"":n)+'</span></button></li><li><button class="delete outline danger special"><i class="fa fa-trash"></i><span>'+jade.escape(null==(n=t("card actions delete"))?"":n)+"</span></button></li>"),o.push('<li class="tags"></li></ul></aside></div></div>')}.call(this,"_id"in r?r._id:"undefined"!=typeof _id?_id:void 0,"edit"in r?r.edit:"undefined"!=typeof edit?edit:void 0,"id"in r?r.id:"undefined"!=typeof id?id:void 0,"lists"in r?r.lists:"undefined"!=typeof lists?lists:void 0,"undefined"in r?r.undefined:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/components/add_field_dropdown",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e){o.push('<dt role="button" class="outline secondary caret">'+jade.escape(null==(n=t("card actions add select"))?"":n)+'<i class="fa fa-caret-down"></i></dt><dd role="listbox"><ul>'),null==e&&o.push('<li role="option"><button value="bday" class="link">'+jade.escape(null==(n=t("card actions add birthday"))?"":n)+"</button></li>"),o.push('<li role="option"><button value="social" class="link">'+jade.escape(null==(n=t("card actions add social"))?"":n)+'</button></li><li role="option"><button value="url" class="link">'+jade.escape(null==(n=t("card actions add link"))?"":n)+'</button></li><li role="option"><button value="other" class="link">'+jade.escape(null==(n=t("card actions add other"))?"":n)+'</button></li><!-- The text that is displayed for this link is "cozy cloud". This is--><!-- because the purpose of this particular link is to provide a url with--><!-- which will be able to share data. For now the only - technically--><!-- speaking - sharing end-point we have at our disposal is another Cozy--><!-- Cloud (but we would like to extend that possibility to other cloud--><!-- providers), hence the choice.--><li role="option"><button value="share" class="link">'+jade.escape(null==(n=t("card actions add share"))?"":n)+"</button></li></ul></dd>")}.call(this,"bday"in r?r.bday:"undefined"!=typeof bday?bday:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/components/avatar",function(t,e,n){var o=function(t){var e,n=[],o=t||{};return function(t,o,r){t?n.push("<img"+jade.attr("src",t,!0,!1)+' class="avatar"/>'):n.push("<span"+jade.attr("style","background-color:"+o,!0,!1)+' class="avatar initials">'+jade.escape(null==(e=r)?"":e)+"</span>")}.call(this,"avatar"in o?o.avatar:"undefined"!=typeof avatar?avatar:void 0,"bg"in o?o.bg:"undefined"!=typeof bg?bg:void 0,"initials"in o?o.initials:"undefined"!=typeof initials?initials:void 0),n.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/templates/contacts/components/data",function(e,n,o){var r=function(e){var n,o=[],r={},i=e||{};return function(e,i,a,s,l,c,u,p,d,f){r.formatJob=n=function(t,e,r){this&&this.block,this&&this.attributes||{};t&&o.push(jade.escape(null==(n=t)?"":n)),t&&e&&o.push(" - "),e&&o.push(jade.escape(null==(n=e)?"":n)),(e&&r||t&&r)&&o.push(" "),r&&o.push("("+jade.escape(null==(n=r)?"":n)+")")},r.input=n=function(e,r){var i=(this&&this.block,this&&this.attributes||{}),a=t("datapoint label "+e.replace("."," ")),s=[e,u].join("-"),l=i.placeholder?t("datapoint placeholder "+e):!1,c=i.value;o.push("<label"+jade.attr("for",s,!0,!1)+' class="group"><span class="type">'+jade.escape(null==(n=a)?"":n)+"</span>"),"textarea"==r?o.push("<textarea"+jade.attr("id",s,!0,!1)+jade.attr("name",e,!0,!1)+' class="value">'+jade.escape(null==(n=c)?"":n)+"</textarea>"):o.push("<input"+jade.attr("id",s,!0,!1)+jade.attr("name",e,!0,!1)+' type="text"'+jade.attr("value",c,!0,!1)+jade.attr("placeholder",l,!0,!1)+jade.cls(["value",c?void 0:"empty"],[null,!0])+'/><button class="link clear"><div class="fa fa-times"></div></button>'),o.push("</label>")},i?(r.input.call({attributes:{value:jade.escape(s.prefix)}},"name.prefix"),r.input.call({attributes:{value:jade.escape(s.first)}},"name.first"),r.input.call({attributes:{value:jade.escape(s.middle)}},"name.middle"),r.input.call({attributes:{value:jade.escape(s.given)}},"name.given"),r.input.call({attributes:{value:jade.escape(s.suffix)}},"name.suffix"),o.push('<fieldset data-type="infos" class="block">'),r.input.call({attributes:{value:jade.escape(c),placeholder:!0}},"org"),r.input.call({attributes:{value:jade.escape(e),placeholder:!0}},"department"),r.input.call({attributes:{value:jade.escape(d),placeholder:!0}},"title"),o.push("</fieldset>")):(o.push("<header><h1>"+(null==(n=a)?"":n)+'</h1><ul class="tags">'),function(){var t=p;if("number"==typeof t.length)for(var e=0,r=t.length;r>e;e++){var i=t[e];o.push("<li>"+jade.escape(null==(n=i)?"":n)+"</li>")}else{var r=0;for(var e in t){r++;var i=t[e];o.push("<li>"+jade.escape(null==(n=i)?"":n)+"</li>")}}}.call(this),o.push('</ul></header><ul data-type="infos" class="block">'),(d||c||e||l)&&((d||c||e)&&(o.push("<li>"),r.formatJob(d,c,e),o.push("</li>")),l&&o.push("<li>"+jade.escape(null==(n=l)?"":n)+"</li>")),o.push("</ul>")),o.push('<div data-type="tel" class="block datapoints"></div><div data-type="email" class="block datapoints"></div><div data-type="adr" class="block datapoints"></div><div class="block"><div data-type="xtras" class="datapoints"></div><div data-type="xtras-infos"></div>'),i&&r.input.call({attributes:{value:jade.escape(l)}},"note","textarea"),o.push("</div>"),i&&o.push('<div class="actions"></div>')}.call(this,"department"in i?i.department:"undefined"!=typeof department?department:void 0,"edit"in i?i.edit:"undefined"!=typeof edit?edit:void 0,"fullname"in i?i.fullname:"undefined"!=typeof fullname?fullname:void 0,"name"in i?i.name:"undefined"!=typeof name?name:void 0,"note"in i?i.note:"undefined"!=typeof note?note:void 0,"org"in i?i.org:"undefined"!=typeof org?org:void 0,"ref"in i?i.ref:"undefined"!=typeof ref?ref:void 0,"tags"in i?i.tags:"undefined"!=typeof tags?tags:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0,"undefined"in i?i.undefined:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/components/datapoint",function(e,n,o){var r=function(e){var n,o=[],r={},i=e||{};return function(e,i,a,s,l,c){r.formatPoint=n=function(t,e){this&&this.block,this&&this.attributes||{};if(e)switch(t.type.toLowerCase()){case"home":var e="home";break;case"work":var e="building";break;default:switch(t.name){case"tel":var e="phone";break;case"email":var e="envelope";break;default:var e=!1}}o.push("<i"+jade.cls(["type",e?"fa fa-"+e:!1],[null,!0])+">"+jade.escape(null==(n=t.type)?"":n)+'&nbsp;</i><span class="value">'+(null==(n=t.value.replace(/\n/g,"<br>"))?"":n)+"</span>")},r.groupInput=n=function(e,r,a){var s=(this&&this.block,this&&this.attributes||{}),l=s.placeholder?t("datapoint placeholder "+("default"==i?e.name:i)):!1,u=r+"."+a;o.push("<input"+jade.attr("id",""+u+".type-"+c,!0,!1)+jade.attr("name",""+u+".type",!0,!1)+' type="text"'+jade.attr("value",e.type,!0,!1)+jade.attr("list","list-"+i,!0,!1)+' class="type"/>'),"adr"==r?o.push("<textarea"+jade.attr("id",""+u+".value-"+c,!0,!1)+jade.attr("name",""+u+".value",!0,!1)+jade.cls(["value",e.value?void 0:"empty"],[null,!0])+">"+jade.escape(null==(n=e.value)?"":n)+"</textarea>"):o.push("<input"+jade.attr("id",""+u+".value-"+c,!0,!1)+jade.attr("name",""+u+".value",!0,!1)+' type="text"'+jade.attr("value",e.value,!0,!1)+jade.attr("placeholder",l,!0,!1)+jade.cls(["value",e.value?void 0:"empty"],[null,!0])+"/>"),o.push('<button class="link delete"><div class="fa fa-trash"></div></button><input'+jade.attr("id",""+u+".name-"+c,!0,!1)+jade.attr("name",""+u+".name",!0,!1)+' type="hidden"'+jade.attr("value",e.name,!0,!1)+' class="name"/>')},e?r.groupInput.call({attributes:{placeholder:!0}},l,s,a):r.formatPoint(l)}.call(this,"edit"in i?i.edit:"undefined"!=typeof edit?edit:void 0,"entity"in i?i.entity:"undefined"!=typeof entity?entity:void 0,"index"in i?i.index:"undefined"!=typeof index?index:void 0,"name"in i?i.name:"undefined"!=typeof name?name:void 0,"point"in i?i.point:"undefined"!=typeof point?point:void 0,"ref"in i?i.ref:"undefined"!=typeof ref?ref:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/components/edit_tags",function(e,n,o){var r=function(e){var n,o=[];return o.push('<dt role="button" class="outline secondary caret"><i class="fa fa-tags fa-flip-horizontal"></i>'+jade.escape(null==(n=t("card actions labels"))?"":n)+'<i class="fa fa-caret-down"></i></dt><dd><fieldset><legend>'+jade.escape(null==(n=t("card actions labels add"))?"":n)+'</legend><ul></ul><div aria-expanded="false" class="create"><label for="tag-new"><input type="text" name="name"/></label><button><i class="fa fa-plus"></i>'+jade.escape(null==(n=t("card actions labels create"))?"":n)+"</button></div></fieldset></dd>"),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/components/tag",function(t,e,n){var o=function(t){var e,n=[],o=t||{};return function(t,o,r){var i=t.slice(-6);n.push("<label"+jade.attr("for","tag-"+i,!0,!1)+'><input type="checkbox"'+jade.attr("id","tag-"+i,!0,!1)+' name="tags"'+jade.attr("value",t,!0,!1)+jade.attr("checked",r,!0,!1)+'/><span class="label">'+jade.escape(null==(e=o)?"":e)+"</span></label>")}.call(this,"_id"in o?o._id:"undefined"!=typeof _id?_id:void 0,"name"in o?o.name:"undefined"!=typeof name?name:void 0,"selected"in o?o.selected:"undefined"!=typeof selected?selected:void 0),n.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/templates/contacts/components/xtras",function(e,n,o){var r=function(e){var n,o=[],r={},i=e||{};return function(e,i,a,s){r.formatPoint=n=function(t,e){this&&this.block,this&&this.attributes||{};if(e)switch(t.type.toLowerCase()){case"home":var e="home";break;case"work":var e="building";break;default:switch(t.name){case"tel":var e="phone";break;case"email":var e="envelope";break;default:var e=!1}}o.push("<i"+jade.cls(["type",e?"fa fa-"+e:!1],[null,!0])+">"+jade.escape(null==(n=t.type)?"":n)+'&nbsp;</i><span class="value">'+(null==(n=t.value.replace(/\n/g,"<br>"))?"":n)+"</span>")},r.input=n=function(e,r){var a=(this&&this.block,this&&this.attributes||{}),s=t("datapoint label "+e.replace("."," ")),l=[e,i].join("-"),c=a.placeholder?t("datapoint placeholder "+e):!1,u=a.value;o.push("<label"+jade.attr("for",l,!0,!1)+' class="group"><span class="type">'+jade.escape(null==(n=s)?"":n)+"</span>"),"textarea"==r?o.push("<textarea"+jade.attr("id",l,!0,!1)+jade.attr("name",e,!0,!1)+' class="value">'+jade.escape(null==(n=u)?"":n)+"</textarea>"):o.push("<input"+jade.attr("id",l,!0,!1)+jade.attr("name",e,!0,!1)+' type="text"'+jade.attr("value",u,!0,!1)+jade.attr("placeholder",c,!0,!1)+jade.cls(["value",u?void 0:"empty"],[null,!0])+'/><button class="link clear"><div class="fa fa-times"></div></button>'),o.push("</label>")},function(){var n=s;if("number"==typeof n.length)for(var i=0,a=n.length;a>i;i++){var l=n[i];if(e)r.input.call({attributes:{value:jade.escape(l),placeholder:!0}},i,"text");else{var c={type:t("datapoint label "+i),value:l};o.push('<li class="group">'),r.formatPoint(c),o.push("</li>")}}else{var a=0;for(var i in n){a++;var l=n[i];if(e)r.input.call({attributes:{value:jade.escape(l),placeholder:!0}},i,"text");else{var c={type:t("datapoint label "+i),value:l};o.push('<li class="group">'),r.formatPoint(c),o.push("</li>")}}}}.call(this)}.call(this,"edit"in i?i.edit:"undefined"!=typeof edit?edit:void 0,"ref"in i?i.ref:"undefined"!=typeof ref?ref:void 0,"undefined"in i?i.undefined:void 0,"xtras"in i?i.xtras:"undefined"!=typeof xtras?xtras:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/helpers",function(t,e,n){var o=function(t){var e=[];return e.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/templates/contacts/index",function(t,e,n){var o=function(t){var e,n=[],o=t||{};return function(t){t&&n.push('<dt role="columnheader">'+jade.escape(null==(e=t)?"":e)+"</dt><dd><ul></ul></dd>")}.call(this,"char"in o?o["char"]:"undefined"!=typeof char?char:void 0),n.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/templates/contacts/merge",function(e,n,o){var r=function(e){var n,o=[],r={},i=e||{};return function(e){r.radio=n=function(t,r){this&&this.block,this&&this.attributes||{};o.push("<ul"+jade.cls(["avatar"==r?"avatars":""],[!0])+">"),function(){var i=t;if("number"==typeof i.length)for(var a=0,s=i.length;s>a;a++){var l=i[a],c=l.index,u=["merge",r,c].join("-"),p=e[r]==c;o.push("<li><label"+jade.attr("for",u,!0,!1)+">"),"avatar"==r?o.push('<input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><img"+jade.attr("src",l.value,!0,!1)+"/>"):(o.push('<span data-input="radio"><input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><label"+jade.attr("for",u,!0,!1)+"></label></span><span>"),"fullname"==r?o.push(null==(n=l.value)?"":n):o.push(jade.escape(null==(n=l.value)?"":n)),o.push("</span>")),o.push("</label></li>")}else{var s=0;for(var a in i){s++;var l=i[a],c=l.index,u=["merge",r,c].join("-"),p=e[r]==c;o.push("<li><label"+jade.attr("for",u,!0,!1)+">"),"avatar"==r?o.push('<input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><img"+jade.attr("src",l.value,!0,!1)+"/>"):(o.push('<span data-input="radio"><input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><label"+jade.attr("for",u,!0,!1)+"></label></span><span>"),"fullname"==r?o.push(null==(n=l.value)?"":n):o.push(jade.escape(null==(n=l.value)?"":n)),o.push("</span>")),o.push("</label></li>")}}}.call(this),o.push("</ul>")},o.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo">'),r.radio=n=function(t,r){this&&this.block,this&&this.attributes||{};o.push("<ul"+jade.cls(["avatar"==r?"avatars":""],[!0])+">"),function(){var i=t;if("number"==typeof i.length)for(var a=0,s=i.length;s>a;a++){var l=i[a],c=l.index,u=["merge",r,c].join("-"),p=e[r]==c;o.push("<li><label"+jade.attr("for",u,!0,!1)+">"),"avatar"==r?o.push('<input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><img"+jade.attr("src",l.value,!0,!1)+"/>"):(o.push('<span data-input="radio"><input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><label"+jade.attr("for",u,!0,!1)+"></label></span><span>"),"fullname"==r?o.push(null==(n=l.value)?"":n):o.push(jade.escape(null==(n=l.value)?"":n)),o.push("</span>")),o.push("</label></li>")}else{var s=0;for(var a in i){s++;var l=i[a],c=l.index,u=["merge",r,c].join("-"),p=e[r]==c;o.push("<li><label"+jade.attr("for",u,!0,!1)+">"),"avatar"==r?o.push('<input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><img"+jade.attr("src",l.value,!0,!1)+"/>"):(o.push('<span data-input="radio"><input type="radio"'+jade.attr("name",r,!0,!1)+jade.attr("value",c,!0,!1)+jade.attr("id",u,!0,!1)+jade.attr("checked",p,!0,!1)+"/><label"+jade.attr("for",u,!0,!1)+"></label></span><span>"),"fullname"==r?o.push(null==(n=l.value)?"":n):o.push(jade.escape(null==(n=l.value)?"":n)),o.push("</span>")),o.push("</label></li>")}}}.call(this),o.push("</ul>")},o.push("<h1>"+jade.escape(null==(n=t("merge title"))?"":n)+"</h1><dl>"),null!=e.mergeOptions.avatar&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose avatar"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.avatar,"avatar"),o.push("</dd>")),null!=e.mergeOptions.fullname&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose name"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.fullname,"fullname"),o.push("</dd>")),null!=e.mergeOptions.nickname&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose nickname"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.nickname),o.push("</dd>")),(null!=e.mergeOptions.org||null!=e.mergeOptions.department||null!=e.mergeOptions.title)&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose organisation"))?"":n)+"</dt><dd><dl>"),null!=e.mergeOptions.org&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose org"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.org,"org"),o.push("</dd>")),null!=e.mergeOptions.department&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose department"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.department,"department"),o.push("</dd>")),null!=e.mergeOptions.title&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose title"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.title,"title"),o.push("</dd>")),o.push("</dl></dd>")),null!=e.mergeOptions.bday&&(o.push("<dt>"+jade.escape(null==(n=t("merge choose birthday"))?"":n)+"</dt><dd>"),r.radio(e.mergeOptions.bday,"bday"),o.push("</dd>")),o.push('</dl><nav><ul class="actions"><li><button type="submit"><div class="fa fa-code-fork"></div><span>'+jade.escape(null==(n=t("merge actions merge"))?"":n)+'</span></button></li><li><button class="cancel outline secondary"><span>'+jade.escape(null==(n=t("merge actions cancel"))?"":n)+"</span></button></li></ul></nav></div></div>")}.call(this,"model"in i?i.model:"undefined"!=typeof model?model:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/contacts/row",function(t,e,o){var r=function(t){var e,o=[],r={},i=t||{};return function(t,n,i,a,s,l,c,u,p,d,f){if(r.formatPoint=e=function(t,n){this&&this.block,this&&this.attributes||{};if(n)switch(t.type.toLowerCase()){case"home":var n="home";break;case"work":var n="building";break;default:switch(t.name){case"tel":var n="phone";break;case"email":var n="envelope";break;default:var n=!1}}o.push("<i"+jade.cls(["type",n?"fa fa-"+n:!1],[null,!0])+">"+jade.escape(null==(e=t.type)?"":e)+'&nbsp;</i><span class="value">'+(null==(e=t.value.replace(/\n/g,"<br>"))?"":e)+"</span>")},r.formatDatapoints=e=function(t,e){this&&this.block,this&&this.attributes||{};if(null!=t&&t.length){var n=t.length>1;o.push('<dl role="gridcell"'+jade.attr("aria-haspopup",n?"true":"false",!0,!1)+' aria-expanded="false" data-position="bottom right"'+jade.cls([e],[!0])+"><dt>"),r.formatPoint(t[0]),n&&o.push('<span class="fa fa-caret-down"></span>'),o.push("</dt>"),n&&(o.push("<dd><ul>"),function(){var e=t;if("number"==typeof e.length)for(var n=0,i=e.length;i>n;n++){var a=e[n];o.push("<li>"),r.formatPoint(a,!0),o.push("</li>")}else{var i=0;for(var n in e){i++;var a=e[n];o.push("<li>"),r.formatPoint(a,!0),o.push("</li>")}}}.call(this),o.push("</ul></dd>")),o.push("</dl>")}else o.push('<div role="gridcell"'+jade.cls(["placeholder",e],[null,!0])+"></div>")},o.push('<span data-input="checkbox"><input type="checkbox"'+jade.attr("id",p,!0,!1)+' name="bulk"'+jade.attr("value",s,!0,!1)+jade.attr("checked",d,!0,!1)+"/><label"+jade.attr("for",p,!0,!1)+'></label></span><a role="gridcell"'+jade.attr("href","contacts/"+t,!0,!1)+' class="name">'),n){if(c)var h=n;else var h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";o.push("<img"+jade.attr("data-src",n,!0,!1)+jade.attr("src",h,!0,!1)+' class="avatar"/>')}else{var m=ColorHash.getColor(u,"cozy");o.push("<span"+jade.attr("style","background-color:"+m,!0,!1)+' class="avatar initials">'+jade.escape(null==(e=l)?"":e)+"</span>")}o.push("<p>"+(null==(e=a)?"":e)+"</p></a>"),r.formatDatapoints(f,"tel"),r.formatDatapoints(i,"email")}.call(this,"_id"in i?i._id:"undefined"!=typeof _id?_id:void 0,"avatar"in i?i.avatar:"undefined"!=typeof avatar?avatar:void 0,"email"in i?i.email:"undefined"!=typeof email?email:void 0,"fullname"in i?i.fullname:"undefined"!=typeof fullname?fullname:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"initials"in i?i.initials:"undefined"!=typeof initials?initials:void 0,"isAvatarLoaded"in i?i.isAvatarLoaded:"undefined"!=typeof isAvatarLoaded?isAvatarLoaded:void 0,"n"in i?i.n:"undefined"!=typeof n?n:void 0,"ref"in i?i.ref:"undefined"!=typeof ref?ref:void 0,"selected"in i?i.selected:"undefined"!=typeof selected?selected:void 0,"tel"in i?i.tel:"undefined"!=typeof tel?tel:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/duplicates/index",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e){o.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo"><h1>'+jade.escape(null==(n=t("duplicates title"))?"":n)+"</h1>"),e>0?o.push('<div role="grid"></div>'):o.push('<p class="empty">'+jade.escape(null==(n=t("duplicates empty"))?"":n)+"</p>"),o.push("</div></div>")}.call(this,"size"in r?r.size:"undefined"!=typeof size?size:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/duplicates/row",function(e,n,o){var r=function(e){var n,o=[],r={},i=e||{};return function(e,i,a,s,l,c){r.formatPoint=n=function(t,e){this&&this.block,this&&this.attributes||{};if(e)switch(t.type.toLowerCase()){case"home":var e="home";break;case"work":var e="building";break;default:switch(t.name){case"tel":var e="phone";break;case"email":var e="envelope";break;default:var e=!1}}o.push("<i"+jade.cls(["type",e?"fa fa-"+e:!1],[null,!0])+">"+jade.escape(null==(n=t.type)?"":n)+'&nbsp;</i><span class="value">'+(null==(n=t.value.replace(/\n/g,"<br>"))?"":n)+"</span>")},r.fullname=n=function(t){this&&this.block,this&&this.attributes||{};o.push("<p>"+(null==(n=t.toString({pre:"<b>",post:"</b>"}))?"":n)+"</p>")},r.formatDatapoints=n=function(t,e){this&&this.block,this&&this.attributes||{};null!=t&&t.length?(o.push('<dl role="gridcell" aria-haspopup="true"'+jade.cls([e],[!0])+"><dt>"),r.formatPoint(t[0]),o.push("</dt></dl>")):o.push('<div role="gridcell"'+jade.cls(["placeholder",e],[null,!0])+"></div>")},r.contactrow=n=function(t){var e=(this&&this.block,this&&this.attributes||{},t.toJSON());o.push('<div role="gridcell" class="name">'),e.avatar?o.push("<img"+jade.attr("src",e.avatar,!0,!1)+' class="avatar"/>'):o.push('<span class="avatar initials">'+jade.escape(null==(n=e.initials)?"":n)+"</span>"),r.fullname(t),o.push("</div>"),r.formatDatapoints(e.tel,"tel"),r.formatDatapoints(e.email,"email")},s?r.contactrow(s):(o.push('<dt role="columnheader">'),r.fullname(e[0]),o.push('<div class="btn-group"><button class="cancel outline secondary"><span>'+jade.escape(null==(n=t("mergerow actions dismiss"))?"":n)+'</span></button><button type="submit"'+jade.attr("disabled",!i,!0,!1)+jade.attr("aria-busy",a,!0,!1)+'><div class="fa fa-code-fork"></div><span>'+jade.escape(null==(n=t("mergerow actions merge"))?"":n)+"</span></button></div></dt><dd><ul>"),function(){var t=e;if("number"==typeof t.length)for(var n=0,i=t.length;i>n;n++){var a=t[n];o.push('<li role="presentation"><label'+jade.attr("for",a.cid,!0,!1)+' role="row"><span data-input="checkbox"><input type="checkbox"'+jade.attr("id",a.cid,!0,!1)+jade.attr("name","mergecontact-"+n,!0,!1)+jade.attr("value",""+n,!0,!1)+jade.attr("checked",l[n],!0,!1)+"/><label"+jade.attr("for",a.cid,!0,!1)+"></label></span>"),r.contactrow(a),o.push("</label></li>")}else{var i=0;for(var n in t){i++;var a=t[n];o.push('<li role="presentation"><label'+jade.attr("for",a.cid,!0,!1)+' role="row"><span data-input="checkbox"><input type="checkbox"'+jade.attr("id",a.cid,!0,!1)+jade.attr("name","mergecontact-"+n,!0,!1)+jade.attr("value",""+n,!0,!1)+jade.attr("checked",l[n],!0,!1)+"/><label"+jade.attr("for",a.cid,!0,!1)+"></label></span>"),r.contactrow(a),o.push("</label></li>")}}}.call(this),o.push("</ul></dd>"))}.call(this,"candidates"in i?i.candidates:"undefined"!=typeof candidates?candidates:void 0,"isMergeable"in i?i.isMergeable:"undefined"!=typeof isMergeable?isMergeable:void 0,"merging"in i?i.merging:"undefined"!=typeof merging?merging:void 0,"result"in i?i.result:"undefined"!=typeof result?result:void 0,"selected"in i?i.selected:"undefined"!=typeof selected?selected:void 0,"undefined"in i?i.undefined:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/labels/filter",function(t,e,n){var o=function(t){var e,n=[],o=t||{};return function(t,o,r,i){n.push("<a"+jade.attr("href",t?"contacts":"tags/"+r,!0,!1)+' data-input="radio"'+jade.attr("aria-checked",i?"true":"false",!0,!1)+'><input type="radio"'+jade.attr("id",o,!0,!1)+' name="label-filters"'+jade.attr("checked",i,!0,!1)+"/><label"+jade.attr("for",o,!0,!1)+"></label>"+jade.escape(null==(e=r)?"":e)+"</a>")}.call(this,"_default"in o?o._default:"undefined"!=typeof _default?_default:void 0,"id"in o?o.id:"undefined"!=typeof id?id:void 0,"name"in o?o.name:"undefined"!=typeof name?name:void 0,"selected"in o?o.selected:"undefined"!=typeof selected?selected:void 0),n.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/templates/labels/index",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e,r){o.push("<legend>"+jade.escape(null==(n=t("tools labels filters"))?"":n)+"</legend><nav><ul><li>");var i=!0,a=t("tools labels filters all"),s=null==e;o.push("<a"+jade.attr("href",i?"contacts":"tags/"+a,!0,!1)+' data-input="radio"'+jade.attr("aria-checked",s?"true":"false",!0,!1)+'><input type="radio"'+jade.attr("id",r,!0,!1)+' name="label-filters"'+jade.attr("checked",s,!0,!1)+"/><label"+jade.attr("for",r,!0,!1)+"></label>"+jade.escape(null==(n=a)?"":n)+"</a></li></ul></nav>")}.call(this,"filter"in r?r.filter:"undefined"!=typeof filter?filter:void 0,"id"in r?r.id:"undefined"!=typeof id?id:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/layouts/app",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e){o.push('<aside class="drawer"><div class="tool-actions"></div><div class="tool-labels"></div>'),"select"!=e&&o.push('<footer class="tool-subactions"><nav><ul><li><a href="settings" role="button" class="secondary"><div class="fa fa-cog"></div><span>'+jade.escape(null==(n=t("tools subactions settings"))?"":n)+"</span></a></li></ul></nav></footer>"),o.push('</aside><main><div role="toolbar"></div><div role="contentinfo" tabindex="1"><div role="grid"><div class="indexes"></div><div class="results"></div></div><div class="counter"></div></div></main><div aria-hidden="true" class="dialogs"></div><div aria-hidden="true" class="alerts"></div>')}.call(this,"mode"in r?r.mode:"undefined"!=typeof mode?mode:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/settings/index",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e,r,i,a,s){o.push('<div role="separator"></div><div class="wrapper"><div role="contentinfo"><h1>'+jade.escape(null==(n=t("settings title"))?"":n)+'</h1><div class="group"><h2>'+jade.escape(null==(n=t("settings in-out title"))?"":n)+'</h2><nav><ul><li><input type="file" name="upload"/><button class="import"><i class="fa fa-download"></i>'+jade.escape(null==(n=t("settings in-out import action"))?"":n)+'</button></li><li><button formaction="contacts/export" class="export"><i class="fa fa-upload"></i>'+jade.escape(null==(n=t("settings in-out export action"))?"":n)+"</button></li></ul></nav><div"+jade.cls(["feedback",e?"error":""],[null,!0])+">"),e&&e.upload&&o.push(jade.escape(null==(n=t(e.upload))?"":n)),o.push('</div></div><div class="group"><h2>'+jade.escape(null==(n=t("settings display title"))?"":n)+'</h2><select name="sort" class="btn outline secondary">'),function(){var e=a;if("number"==typeof e.length)for(var r=0,s=e.length;s>r;r++){var l=e[r];o.push("<option"+jade.attr("value",l,!0,!1)+jade.attr("selected",i==l,!0,!1)+">"+jade.escape(null==(n=t("settings display sort "+l))?"":n)+"</option>")}else{var s=0;for(var r in e){s++;var l=e[r];o.push("<option"+jade.attr("value",l,!0,!1)+jade.attr("selected",i==l,!0,!1)+">"+jade.escape(null==(n=t("settings display sort "+l))?"":n)+"</option>")}}}.call(this),o.push('</select></div><div class="group"><h2>'+jade.escape(null==(n=t("settings sync title"))?"":n)+"</h2><p>"+jade.escape(null==(n=t("settings sync gplay"))?"":n)+'<a target="_blank" href="https://play.google.com/store/apps/details?id=io.cozy.files_client"><img'+jade.attr("alt",t("settings sync gplay get it"),!0,!1)+jade.attr("src","//developer.android.com/images/brand/"+r+"_generic_rgb_wo_60.png",!0,!1)+"/></a></p><p>"+(null==(n=t("settings sync carddav",{link:"https://docs.cozy.io/mobile/contacts.html"}).replace(/\[(.+)\]\((.+)\)/i,'<a target="_blank" href="$2">$1</a>'))?"":n)+"</p></div></div></div>")}.call(this,"errors"in r?r.errors:"undefined"!=typeof errors?errors:void 0,"locale"in r?r.locale:"undefined"!=typeof locale?locale:void 0,"sort"in r?r.sort:"undefined"!=typeof sort?sort:void 0,"sortkeys"in r?r.sortkeys:"undefined"!=typeof sortkeys?sortkeys:void 0,"undefined"in r?r.undefined:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/tools/context_actions",function(e,n,o){var r=function(e){var n,o=[],r=e||{};return function(e){o.push("<legend>"+jade.escape(null==(n=t("tools contextual selected",{smart_count:e.length}))?"":n)+'</legend><nav class="select"><ul><li><button formaction="select/all">'+jade.escape(null==(n=t("tools contextual select all"))?"":n)+'</button></li><li><button formaction="select/none">'+jade.escape(null==(n=t("tools contextual select none"))?"":n)+'</button></li></ul></nav><nav><ul><li><button formaction="contacts/merge" class="secondary"><i class="fa fa-code-fork"></i>'+jade.escape(null==(n=t("tools contextual merge"))?"":n)+'</button></li><li><button formaction="contacts/export" class="secondary"><i class="fa fa-upload"></i>'+jade.escape(null==(n=t("tools contextual export"))?"":n)+'</button></li><li><button formaction="contacts/delete" class="secondary"><i class="fa fa-trash"></i>'+jade.escape(null==(n=t("tools contextual delete"))?"":n)+"</button></li></ul></nav>");
}.call(this,"selected"in r?r.selected:"undefined"!=typeof selected?selected:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/tools/default_actions",function(e,n,o){var r=function(e){var n,o=[];return o.push('<nav><ul><li><a href="contacts/new" role="button" class="add secondary"><div class="fa fa-plus"></div><span>'+jade.escape(null==(n=t("tools actions add contact"))?"":n)+'</span></a></li><li><a href="contacts/duplicates" role="button" class="add secondary"><div class="fa fa-code-fork"></div><span>'+jade.escape(null==(n=t("tools actions find duplicates"))?"":n)+"</span></a></li></ul></nav>"),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/tools/search",function(e,n,o){var r=function(e){var n=[];return n.push('<span class="fa fa-search"></span><button class="fa fa-times clear"></button><input type="text" id="contacts-search"'+jade.attr("placeholder",t("tools search placeholder"),!0,!1)+' autocomplete="off"/>'),n.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("views/templates/tools/toolbar",function(t,e,n){var o=function(t){var e=[];return e.push('<button class="drawer-toggle"><i class="fa fa-bars"></i></button>'),e.join("")};"function"==typeof define&&define.amd?define([],function(){return o}):"object"==typeof n&&n&&n.exports&&(n.exports=o)}),require.register("views/tools/context_actions",function(e,n,o){var r,i=function(t,e){return function(){return t.apply(e,arguments)}},a=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o.exports=r=function(e){function o(){return this._deleteModalCfg=i(this._deleteModalCfg,this),o.__super__.constructor.apply(this,arguments)}return a(o,e),o.prototype.template=n("views/templates/tools/context_actions"),o.prototype.tagName="fieldset",o.prototype.behaviors=function(){return{Confirm:{triggers:{"click @ui.delete":this._deleteModalCfg}}}},o.prototype.ui={select:'[formaction="select/all"]',unselect:'[formaction="select/none"]',merge:'[formaction="contacts/merge"]',"export":'[formaction="contacts/export"]',"delete":'[formaction="contacts/delete"]'},o.prototype.triggers={"click @ui.select":"select:all","click @ui.unselect":"select:none","click @ui.export":"bulk:export","click @ui.merge":"bulk:merge"},o.prototype.modelEvents={"change:selected":function(t,e){return e.length?this.render():void 0}},o.prototype.initialize=function(){return Mn.bindEntityEvents(this.model,this,this.model.viewEvents)},o.prototype._deleteModalCfg=function(){var e,n;return n={smart_count:this.model.get("selected").length},e={event:"bulk:delete",title:t("bulk confirm delete title",n),message:t("bulk confirm delete message",n),btn_ok:t("bulk confirm delete ok"),btn_cancel:t("bulk confirm delete cancel"),end_event:"bulk:delete:done"}},o}(Mn.ItemView)}),require.register("views/tools/default_actions",function(t,e,n){var o,r=function(t,e){function n(){this.constructor=t}for(var o in e)i.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;n.exports=o=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.prototype.template=e("views/templates/tools/default_actions"),n.prototype.tagName="fieldset",n}(Mn.ItemView)}),require.register("views/tools/search",function(t,e,n){var o,r,i,a=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=e("config").ERR,i=null,n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.template=e("views/templates/tools/search"),n.prototype.tagName="label",n.prototype.className="empty",n.prototype.attributes={"for":"contacts-search"},n.prototype.ui={search:"input",clear:"button.clear"},n.prototype._lastValue=void 0,n.prototype.events=function(){return{"click @ui.clear":function(){return i.search("text",null)},"keyup @ui.search":_.debounce(function(t){var e,n;return 27===t.which?i.search("text",null):(n=t.currentTarget.value,0===n.length?i.search("text",null):n.length>2?(i.search("text",n),this._lastValue=n):n.length<(null!=(e=this._lastValue)?e.length:void 0)?i.channel.trigger("search:error",o.SEARCH_TOO_SHORT):void 0)},450,{trailing:!0,maxWait:350})}},n.prototype.initialize=function(){return i=e("application"),this.listenTo(i.channel,{"filter:text":this.updateSearch,"search:error":function(){return this.el.querySelector("input").setAttribute("aria-invalid",!0)}})},n.prototype.onDomRefresh=function(){return this.ui.search.trigger("focus")},n.prototype.updateSearch=function(t){return this.ui.search.val(t),this.toggleUi(t)},n.prototype.toggleUi=function(t){return this.el.classList.toggle("empty",_.isEmpty(t)),this.el.querySelector("input").setAttribute("aria-invalid",!1)},n}(Mn.ItemView)}),require.register("views/tools/toolbar",function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=e("views/tools/search"),n.exports=r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.template=e("views/templates/tools/toolbar"),n.prototype.ui={drawer:".drawer-toggle"},n.prototype.triggers={"click @ui.drawer":"drawer:toggle"},n.prototype.onRender=function(){return(new o).render().$el.appendTo(this.$el)},n}(Mn.ItemView)});